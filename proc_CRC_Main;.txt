create or replace procedure proc_CRC_Main(p_flag     in varchar2,
                                          p_pageval  in varchar2,
                                          p_parval1  in varchar2,
                                          p_parval2  in varchar2,
                                          p_parval3  in varchar2,
                                          qry_result OUT RESULT_TYPE.QRY_RESULT)

 is
  ----------------------CRF_102144-----358536-----------------------------------------------------
  v_Count            number;
  v_lead_id          number;
  v_Cust_type        number;
  v_count1           number;
  err_stat           number;
  v_next_fid         number;
  v_splitter         array;
  v_splitter2        array;
  type_selected      varchar2(500);
  v_lead_followup_id number;
  nxt_fllw_up_dt     date;
  l_priority         number;
  l_mob              VARCHAR2(60);
  follwup_status     number;
  mst_prid           number;
  a                  number;
  v_dt               date;
  v_ph               VARCHAR2(60);
  v_grpid            number;
  cat                VARCHAR2(60);
  -----------------------------
  empname1 varchar2(100);
  ----------------------------

  badge1 number;
  badge2 number;
  badge3 number;
  badge4 number;
  badge5 number;
  badge6 number;
  badge7 number;
  --------------------------366371
  badge8   number;
  badge9   number;
  badge10  number;
  badge11  number;
  badge12  number;
  ---------339502
  badge13 number;
   badge14 number;
    badge15 number;
     badge16 number;
      badge17 number;
       badge18 number;
       badge19  number;  
  ----------------dm
  badge303 number;
   badge403 number;
    
     badge505 number;
  -----------------
  empcode2      number;
  mob_count     number;
  lead_count1   number;
  empcount      number;
  T_custname    VARCHAR2(50);
  T_branchid    number(4);
  T_mobilnumber VARCHAR2(60);
  v_takeOverid  VARCHAR2(20);
  bkid          number;
  mx_date1      date;
  avl_st        varchar2(20);
  extnumber     number;
  ------------------------
  ------------------------

  v_fllwp_max   number;
  v_response    number;
  disposition   number;
  v_fup_cnt     number;
  v_fup_time    VARCHAR2(60);
  v_post        number;
  v_Call_rep_id number;

  --------------------------yadhu
  mst_name       VARCHAR2(60);
  mst_mobile     VARCHAR2(60);
  mst_comment    VARCHAR2(200);
  mst_branch     number;
  mst_leaddate   date;
  mst_followdate date;
  mst_inserton   date;
  mst_proname    VARCHAR2(200);
  mst_mail       VARCHAR2(200);
  mst_reqamount  number;
  notify         number;


  v_ErrDesc TBL_ITC_PORTAL_ERROR_DTL.error_description%type;
  v_ErrDtl  TBL_ITC_PORTAL_ERROR_DTL.error_details%type;
  v_ErrID   TBL_ITC_PORTAL_ERROR_DTL.error_id%type;

  ----------------------CRF_102144-----358536-----------------------------------------------------
begin

  err_stat := 0;

  if p_flag = 'Get_Lead_Details' then
  
    ---------------release employeee code above 20minutes lock --------------------------366371
    --update tbl_crc_mst t set t.inserted_on=sysdate,t.next_followup_date=sysdate,t.lead_date=sysdate where t.followup_status=0 and sysdate> t.inserted_on + interval '8' minute;
  
    update tbl_crc_mst t
       set t.emp_code = null, t.emp_lock_tym = null
     where t.followup_status = 0
       and t.emp_code is not null
       and sysdate > t.emp_lock_tym + interval '21' minute;
    update tbl_crc_mst t
       set t.emp_code = null, t.emp_lock_tym = null
     where t.lead_id in (select c.lead_id
                           from tbl_crc_mst c
                          where c.CALL_RESPONSE_ID > 1
                            and c.followup_status > 0 /*and (c.emp_code is null or c.emp_code =p_pageval) */
                            and nvl(c.lead_staus, 1) <> 0
                            and c.intrested_status not in (2))
       and sysdate > t.emp_lock_tym + interval '21' minute;
  
    ---------------------------------------end release employee lock------------------------366371
    ----Priority to leadfollowup on time.
  
    select count(c.lead_id)
      into v_fup_cnt
      from tbl_crc_mst c
     where c.followup_status = 1
       and c.call_response_id < 2
       and c.intrested_status not in (2, 3)
       and trunc(c.next_followup_date) = trunc(sysdate)
       and to_char(c.next_fup_time) = to_char(sysdate, 'HH24')
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type <> 333;
    if v_fup_cnt > 0 then
      select max(c.lead_id)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and to_char(c.next_fup_time) = to_char(sysdate, 'HH24')
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type <> 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      -- open QRY_RESULT for select '222'|| 'µ'|| t.lead_id|| 'µ'||f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead'|| 'µ' || trunc(f.NEXT_FOLLOWUP_DATE) || 'µ' ||f.followup_reason|| 'µ'|| t.cust_mail from TBL_CRC_MST t, TBL_CRC_FOLLOWUP_DTL f,tbl_leadsource_category s, TBL_CRC_PRODUCTSs p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and trunc(t.next_followup_date) = trunc(f.NEXT_FOLLOWUP_DATE) and t.interested_product_id = p.products_id and t.lead_id = v_lead_id ;
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and trunc(t.next_followup_date) = trunc(f.next_followup_date)
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
      --- Release lock  against employee
      update TBL_CRC_MST tt
         set tt.emp_code = null
       WHERE tt.emp_code = p_pageval
         and tt.followup_status = 0
         and trunc(tt.inserted_on) = trunc(sysdate);
      ---------------------------------- --Today Lead call pending
      --select distinct count(t.bucket_id) into v_count from TBL_CRC_MST t, TBL_CRC_EMP_DTLS e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
      --latest--- select distinct count(t.lead_id) into v_count from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval and  t.lead_source_cat<>13;
      select distinct count(t.lead_id)
        into v_count
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and trunc(t.inserted_on) = trunc(sysdate)
         and t.emp_code is null
         and e.emp_code = p_pageval
         and t.lead_source_cat in (8)
         and t.inserted_type <> 333;
    
      if v_count > 0 then
      
        -- LastInFirstOut Lead
        -- select nvl(max(t.lead_id), 0) into v_lead_id from TBL_CRC_MST t, TBL_CRC_EMP_DTLS e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval order by t.inserted_type ;
        -- select nvl(max(t.lead_id), 0)   into v_lead_id from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and  t.lead_source_cat<>13 and t.emp_code is null and e.emp_code = p_pageval order by t.inserted_type;
        select nvl(max(t.lead_id), 0)
          into v_lead_id
          from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
         where t.bucket_id = e.bucket_id
           and t.followup_status = 0
           and trunc(t.inserted_on) = trunc(sysdate)
           and t.lead_source_cat in (8)
           and t.inserted_type <> 333
           and t.emp_code is null
           and e.emp_code = p_pageval
         order by t.inserted_type;
        select t.mobile_number
          into l_mob
          from tbl_crc_mst t
         where t.lead_id = v_lead_id;
        select count(c.cust_id)
          into v_cust_type
          from customer c
         where c.phone1 = to_char(l_mob)
            or c.phone2 = to_char(l_mob);
        -----Lock Lead against emp & customer type update.
        --update TBL_CRC_MST t set t.emp_code =  p_pageval,t.emp_lock_tym=sysdate,t.customer_type_id = nvl(v_cust_type,0) where t.lead_id = v_lead_id ;
        update TBL_CRC_MST t
           set t.emp_code         = p_pageval,
               t.emp_lock_tym     = sysdate,
               t.customer_type_id = nvl(v_cust_type, 0),
               t.log_empcode      = p_pageval
         where t.lead_id = v_lead_id;
      
        --open QRY_RESULT for select '111'|| 'µ'|| t.lead_id|| 'µ'||'0'||'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
        open QRY_RESULT for
          select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
                 t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                 s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                 TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                   when v_cust_type = 1 then
                    'Existing Customer'
                   else
                    'New Customer'
                 end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
                 t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
                 bb.buck_lang || 'µ' || bm.state_name
            from tbl_crc_mst             t,
                 tbl_leadsource_category s,
                 TBL_CRC_PRODUCTS        p,
                 branch_detail_new       b,
                 tbl_crc_bucksize        bb,
                 state_master            bm
           where t.lead_source_cat = s.leadsource_id
             and t.product_id = p.products_id
             and b.branch_id = t.branch_id
             and b.state_id = bm.state_id
             and bb.bucket_id = t.bucket_id
             and t.lead_id = v_lead_id;
      
      elsif v_count = 0 then
        ------------------Today fresh followup pending
        select count(c.lead_id)
          into v_count1
          from TBL_CRC_MST c
         where c.followup_status = 1
           and c.call_response_id < 2
           and c.intrested_status not in (2, 3)
           and trunc(c.next_followup_date) = trunc(sysdate)
           and c.emp_code = p_pageval
           and nvl(c.lead_staus, 1) <> 0
           and c.inserted_type <> 333;
        --   select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) = trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1  group by f.lead_id having count(f.lead_id) >= 2);
      
        if v_count1 > 0 then
        
          -- LastInFirstOut Lead
          --  select nvl(max(c.lead_id), 0) into v_lead_id from TBL_CRC_MST c where c.followup_status  = 1  and trunc(c.next_followup_date) = trunc(sysdate) and c.emp_code = p_pageval;
          select nvl(max(c.lead_id), 0)
            into v_lead_id
            from tbl_crc_mst c
           where c.followup_status = 1
             and c.call_response_id < 2
             and c.intrested_status not in (2, 3)
             and c.call_response_id < 2
             and trunc(c.next_followup_date) = trunc(sysdate)
             and c.emp_code = p_pageval
             and nvl(c.lead_staus, 1) <> 0
             and c.inserted_type <> 333;
          select t.mobile_number
            into l_mob
            from tbl_crc_mst t
           where t.lead_id = v_lead_id;
        
          select count(c.cust_id)
            into v_cust_type
            from customer c
           where c.phone1 = to_char(l_mob)
              or c.phone2 = to_char(l_mob);
        
          --open QRY_RESULT for select '222'|| 'µ'|| t.lead_id|| 'µ'||f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead'|| 'µ' || trunc(f.NEXT_FOLLOWUP_DATE) || 'µ' ||f.followup_reason|| 'µ'|| t.cust_mail from TBL_CRC_MST t, TBL_CRC_FOLLOWUP_DTL f,tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and trunc(t.next_followup_date) = trunc(f.NEXT_FOLLOWUP_DATE) and t.interested_product_id = p.products_id and t.lead_id = v_lead_id;
          open QRY_RESULT for
            select '222' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
                   t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                   s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                   TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                     when v_cust_type = 1 then
                      'Existing Customer'
                     else
                      'New Customer'
                   end || 'µ' || 'Follow Up Lead' || 'µ' ||
                   trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
                   t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                   b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                   bm.state_name
              from tbl_crc_mst             t,
                   tbl_crc_followup_dtl    f,
                   tbl_leadsource_category s,
                   TBL_CRC_PRODUCTS        p,
                   branch_detail_new       b,
                   tbl_crc_bucksize        bb,
                   state_master            bm
             where t.lead_source_cat = s.leadsource_id
               and t.lead_id = f.lead_id
               and b.branch_id = t.branch_id
               and b.state_id = bm.state_id
               and bb.bucket_id = t.bucket_id
               and trunc(t.next_followup_date) =
                   trunc(f.next_followup_date)
               and nvl(t.interested_product_id, t.product_id) =
                   p.products_id
               and t.lead_id = v_lead_id
               and f.followup_id in
                   (select max(ff.followup_id)
                      from tbl_crc_followup_dtl ff
                     where ff.lead_id = v_lead_id);
        
        else
        
          --- Release lock  against employee
          update tbl_crc_mst tt
             set tt.emp_code = null
           where tt.emp_code = p_pageval
             and tt.followup_status = 0
             and trunc(tt.inserted_on) <> trunc(sysdate);
        
          --- Pending call
          --  select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, tbl_crc_emp_dtls e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
          --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval and  t.lead_source_cat<>13;
          select distinct count(t.lead_id)
            into v_count1
            from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
           where t.bucket_id = e.bucket_id
             and t.followup_status = 0
             and trunc(t.inserted_on) <> trunc(sysdate)
             and t.emp_code is null
             and e.emp_code = p_pageval
             and t.lead_source_cat in (8)
             and t.inserted_type <> 333;
        
          if v_count1 > 0 then
          
            -- -- LastInFirstOut Lead
            -- select nvl(max(t.lead_id), 0) into v_lead_id from tbl_crc_mst t, tbl_crc_emp_dtls e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
            --select nvl(max(t.lead_id), 0) into v_lead_id from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval and  t.lead_source_cat<>13;
            select nvl(max(t.lead_id), 0)
              into v_lead_id
              from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
             where t.bucket_id = e.bucket_id
               and t.followup_status = 0
               and trunc(t.inserted_on) <> trunc(sysdate)
               and t.emp_code is null
               and e.emp_code = p_pageval
               and t.lead_source_cat in (8)
               and t.inserted_type <> 333;
          
            select t.mobile_number
              into l_mob
              from tbl_crc_mst t
             where t.lead_id = v_lead_id;
          
            select count(c.cust_id)
              into v_cust_type
              from customer c
             where c.phone1 = to_char(l_mob)
                or c.phone2 = to_char(l_mob);
          
            -----Lock Lead against emp  & customer type update.
            update TBL_CRC_MST t
               set t.emp_code         = p_pageval,
                   t.emp_lock_tym     = sysdate,
                   t.customer_type_id = nvl(v_cust_type, 0),
                   t.log_empcode      = p_pageval
             where t.lead_id = v_lead_id;
          
            -- open QRY_RESULT for select '444'|| 'µ'|| t.lead_id|| 'µ'||'0'||           'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ' ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
            open QRY_RESULT for
              select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
                     t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                     s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                     TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                       when v_cust_type = 1 then
                        'Existing Customer'
                       else
                        'New Customer'
                     end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
                     t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                     b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                     bm.state_name
                from tbl_crc_mst             t,
                     tbl_leadsource_category s,
                     TBL_CRC_PRODUCTS        p,
                     branch_detail_new       b,
                     tbl_crc_bucksize        bb,
                     state_master            bm
               where t.lead_source_cat = s.leadsource_id
                 and t.product_id = p.products_id
                 and b.branch_id = t.branch_id
                 and b.state_id = bm.state_id
                 and bb.bucket_id = t.bucket_id
                 and t.lead_id = v_lead_id;
          
          else
            ----- Pending Followup Lead call
            select count(c.lead_id)
              into v_count1
              from tbl_crc_mst c
             where c.followup_status = 1
               and c.intrested_status not in (2, 3)
               and c.call_response_id < 2
               and trunc(c.next_followup_date) < trunc(sysdate)
               and c.emp_code = p_pageval
               and nvl(c.lead_staus, 1) <> 0
               and c.inserted_type <> 333;
            -- select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) <> trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1 group by f.lead_id having count(f.lead_id) >= 2);
          
            if v_count1 > 0 then
            
              -- -- LastInFirstOut Lead
              --select nvl(max(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status  = 1  and trunc(c.next_followup_date) <> trunc(sysdate) and c.emp_code = p_pageval;
              select nvl(max(c.lead_id), 0)
                into v_lead_id
                from tbl_crc_mst c
               where c.followup_status = 1
                 and c.call_response_id < 2
                 and c.intrested_status not in (2, 3)
                 and trunc(c.next_followup_date) <> trunc(sysdate)
                 and c.emp_code = p_pageval
                 and nvl(c.lead_staus, 1) <> 0
                 and c.inserted_type <> 333;
            
              select t.mobile_number
                into l_mob
                from tbl_crc_mst t
               where t.lead_id = v_lead_id;
            
              select count(c.cust_id)
                into v_cust_type
                from customer c
               where c.phone1 = to_char(l_mob)
                  or c.phone2 = to_char(l_mob);
            
              --  open QRY_RESULT for select '555' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and trunc(t.next_followup_date) = trunc(f.next_followup_date) and t.product_id = p.products_id and t.lead_id = v_lead_id;
              open QRY_RESULT for
                select '555' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
                       t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                       s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                       TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                         when v_cust_type = 1 then
                          'Existing Customer'
                         else
                          'New Customer'
                       end || 'µ' || 'Follow Up Lead' || 'µ' ||
                       trunc(f.next_followup_date) || 'µ' ||
                       f.followup_reason || 'µ' || t.cust_mail || 'µ' ||
                       t.branch_id || 'µ' || b.branch_name || 'µ' ||
                       bb.buck_lang || 'µ' || bm.state_name
                  from tbl_crc_mst             t,
                       tbl_crc_followup_dtl    f,
                       tbl_leadsource_category s,
                       TBL_CRC_PRODUCTS        p,
                       branch_detail_new       b,
                       tbl_crc_bucksize        bb,
                       state_master            bm
                 where t.lead_source_cat = s.leadsource_id
                   and t.lead_id = f.lead_id
                   and b.branch_id = t.branch_id
                   and b.status_id = bm.state_id
                   and bb.bucket_id = t.bucket_id
                   and trunc(t.next_followup_date) =
                       trunc(f.next_followup_date)
                   and nvl(t.interested_product_id, t.product_id) =
                       p.products_id
                   and f.followup_id in
                       (select max(ff.followup_id)
                          from tbl_crc_followup_dtl ff
                         where ff.lead_id = v_lead_id)
                   and t.lead_id = v_lead_id;
            
            else
              ------------------today non contact
              --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3) and c.inserted_type<>333;
              --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3) and c.inserted_type<>333;
              select count(c.lead_id)
                into v_count1
                from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
               where c.CALL_RESPONSE_ID > 1
                 and c.lead_source_cat <> 202
                 and c.followup_status > 0
                 and (c.emp_code is null or c.emp_code = p_pageval)
                 and nvl(c.lead_staus, 1) <> 0
                 and c.lead_id in
                     (select mm.lead_id as lead_id
                        from TBL_CRC_FOLLOWUP_DTL mm
                       where trunc(mm.inserted_on) = trunc(sysdate))
                 and c.intrested_status not in (2, 3)
                 and c.inserted_type <> 333
                 and c.bucket_id = e.bucket_id
                 and e.emp_code = p_pageval;
            
              if v_count1 > 0 then
                --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0 and c.inserted_type<>333;
                --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and (c.emp_code is null or c.emp_code =p_pageval) and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0 and c.inserted_type<>333;
                select nvl(min(c.lead_id), 0)
                  into v_lead_id
                  from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
                 where c.followup_status > 0
                   and c.lead_source_cat <> 202
                   and c.intrested_status not in (2, 3)
                   and c.CALL_RESPONSE_ID > 1
                   and (c.emp_code is null or c.emp_code = p_pageval)
                   and c.lead_id in
                       (select mm.lead_id as lead_id
                          from TBL_CRC_FOLLOWUP_DTL mm
                         where trunc(mm.inserted_on) = trunc(sysdate))
                   and nvl(c.lead_staus, 1) <> 0
                   and c.inserted_type <> 333
                   and c.bucket_id = e.bucket_id
                   and e.emp_code = p_pageval;
              
                update TBL_CRC_MST t
                   set t.emp_code     = p_pageval,
                       t.emp_lock_tym = sysdate,
                       t.log_empcode  = p_pageval
                 where t.lead_id = v_lead_id;
                select t.mobile_number
                  into l_mob
                  from tbl_crc_mst t
                 where t.lead_id = v_lead_id;
                select count(c.cust_id)
                  into v_cust_type
                  from customer c
                 where c.phone1 = to_char(l_mob)
                    or c.phone2 = to_char(l_mob);
                open QRY_RESULT for
                  select '999' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
                         t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                         s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                         TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                           when v_cust_type = 1 then
                            'Existing Customer'
                           else
                            'New Customer'
                         end || 'µ' || 'Follow Up Lead' || 'µ' ||
                         trunc(f.next_followup_date) || 'µ' ||
                         f.followup_reason || 'µ' || t.cust_mail || 'µ' ||
                         t.branch_id || 'µ' || b.branch_name || 'µ' ||
                         bb.buck_lang || 'µ' || bm.state_name
                    from tbl_crc_mst             t,
                         tbl_crc_followup_dtl    f,
                         tbl_leadsource_category s,
                         TBL_CRC_PRODUCTS        p,
                         branch_detail_new       b,
                         tbl_crc_bucksize        bb,
                         state_master            bm
                   where t.lead_source_cat = s.leadsource_id
                     and t.lead_id = f.lead_id
                     and b.branch_id = t.branch_id
                     and b.state_id = bm.state_id
                     and bb.bucket_id = t.bucket_id
                     and nvl(t.interested_product_id, t.product_id) =
                         p.products_id
                     and t.lead_id = v_lead_id
                     and t.followup_status > 0
                     and t.call_response_id > 1
                     and f.followup_id in
                         (select max(ff.followup_id)
                            from tbl_crc_followup_dtl ff
                           where ff.lead_id = v_lead_id)
                     and t.emp_code = p_pageval;
              
              else
                ----------------------Non Contactable leads
              
                /* select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0  and c.intrested_status not in (2) and c.emp_code = p_pageval and nvl(c.lead_staus,1) <> 0 ;
                if v_count1 > 0 then
                    select nvl(min(c.lead_id), 0)  into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.CALL_RESPONSE_ID > 1   and c.intrested_status not in (2) and c.emp_code = p_pageval and nvl(c.lead_staus,1) <> 0 ;
                    select t.mobile_number into l_mob  from tbl_crc_mst t where t.lead_id = v_lead_id;
                    select count(c.cust_id) into v_cust_type from customer c where c.phone1 = l_mob or c.phone2 = l_mob ;
                      open QRY_RESULT for select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || TO_CHAR(t.inserted_on,'DD-MM-YYYY HH24:MI:SS') || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' || bb.buck_lang || 'µ' || bm.state_name from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and nvl(t.interested_product_id,t.product_id) = p.products_id and t.lead_id = v_lead_id and t.followup_status > 0 and t.call_response_id > 1 and f.followup_id in(select max(ff.followup_id) from tbl_crc_followup_dtl ff where ff.lead_id = v_lead_id) and t.emp_code = p_pageval;
                      */
              
                --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3) and c.inserted_type<>333;
                --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3) and c.inserted_type<>333;
                select count(c.lead_id)
                  into v_count1
                  from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
                 where c.CALL_RESPONSE_ID > 1
                   and c.lead_source_cat <> 202
                   and c.followup_status > 0
                   and (c.emp_code is null or c.emp_code = p_pageval)
                   and nvl(c.lead_staus, 1) <> 0
                   and c.lead_id not in
                       (select mm.lead_id as lead_id
                          from TBL_CRC_FOLLOWUP_DTL mm
                         where trunc(mm.inserted_on) = trunc(sysdate))
                   and c.intrested_status not in (2, 3)
                   and c.inserted_type <> 333
                   and c.bucket_id = e.bucket_id
                   and e.emp_code = p_pageval;
              
                if v_count1 > 0 then
                  --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id not in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0 and c.inserted_type<>333;
                  --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and (c.emp_code is null or c.emp_code =p_pageval) and c.lead_id not in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0 and c.inserted_type<>333;
                  select nvl(min(c.lead_id), 0)
                    into v_lead_id
                    from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
                   where c.followup_status > 0
                     and c.lead_source_cat <> 202
                     and c.intrested_status not in (2, 3)
                     and c.CALL_RESPONSE_ID > 1
                     and (c.emp_code is null or c.emp_code = p_pageval)
                     and c.lead_id not in
                         (select mm.lead_id as lead_id
                            from TBL_CRC_FOLLOWUP_DTL mm
                           where trunc(mm.inserted_on) = trunc(sysdate))
                     and nvl(c.lead_staus, 1) <> 0
                     and c.inserted_type <> 333
                     and c.bucket_id = e.bucket_id
                     and e.emp_code = p_pageval;
                
                  update TBL_CRC_MST t
                     set t.emp_code     = p_pageval,
                         t.emp_lock_tym = sysdate,
                         t.log_empcode  = p_pageval
                   where t.lead_id = v_lead_id;
                
                  select t.mobile_number
                    into l_mob
                    from tbl_crc_mst t
                   where t.lead_id = v_lead_id;
                  select count(c.cust_id)
                    into v_cust_type
                    from customer c
                   where c.phone1 = to_char(l_mob)
                      or c.phone2 = to_char(l_mob);
                  open QRY_RESULT for
                    select '333' || 'µ' || t.lead_id || 'µ' ||
                           f.followup_id || 'µ' || t.cust_name || 'µ' ||
                           t.mobile_number || 'µ' || s.leadsource_name || 'µ' ||
                           t.product_name || 'µ' ||
                           TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                             when v_cust_type = 1 then
                              'Existing Customer'
                             else
                              'New Customer'
                           end || 'µ' || 'Follow Up Lead' || 'µ' ||
                           trunc(f.next_followup_date) || 'µ' ||
                           f.followup_reason || 'µ' || t.cust_mail || 'µ' ||
                           t.branch_id || 'µ' || b.branch_name || 'µ' ||
                           bb.buck_lang || 'µ' || bm.state_name
                      from tbl_crc_mst             t,
                           tbl_crc_followup_dtl    f,
                           tbl_leadsource_category s,
                           TBL_CRC_PRODUCTS        p,
                           branch_detail_new       b,
                           tbl_crc_bucksize        bb,
                           state_master            bm
                     where t.lead_source_cat = s.leadsource_id
                       and t.lead_id = f.lead_id
                       and b.branch_id = t.branch_id
                       and b.state_id = bm.state_id
                       and bb.bucket_id = t.bucket_id
                       and nvl(t.interested_product_id, t.product_id) =
                           p.products_id
                       and t.lead_id = v_lead_id
                       and t.followup_status > 0
                       and t.call_response_id > 1
                       and f.followup_id in
                           (select max(ff.followup_id)
                              from tbl_crc_followup_dtl ff
                             where ff.lead_id = v_lead_id)
                       and t.emp_code = p_pageval;
                
                else
                  -----------------------------call back(time base)
                
                  /*select count(c.lead_id) into v_fup_cnt from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) = trunc(sysdate) and to_char(c.next_fup_time) = to_char(sysdate, 'HH24') and c.emp_code = p_pageval and c.intrested_status=3 and nvl(c.lead_staus, 1) <> 0;
                  if v_fup_cnt > 0  then
                     select max(c.lead_id) into v_lead_id from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) = trunc(sysdate) and to_char(c.next_fup_time) = to_char(sysdate, 'HH24') and c.emp_code = p_pageval and c.intrested_status=3 and nvl(c.lead_staus, 1) <> 0;
                     select t.mobile_number into l_mob  from tbl_crc_mst t where t.lead_id = v_lead_id;
                     select count(c.cust_id) into v_cust_type from customer c where c.phone1 = l_mob or c.phone2 = l_mob ;
                     open QRY_RESULT for select '888' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || TO_CHAR(t.inserted_on,'DD-MM-YYYY HH24:MI:SS') || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' || bb.buck_lang || 'µ' || bm.state_name from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and nvl(t.interested_product_id,t.product_id) = p.products_id and t.lead_id = v_lead_id and t.followup_status > 0 and t.call_response_id > 1 and f.followup_id in(select max(ff.followup_id) from tbl_crc_followup_dtl ff where ff.lead_id = v_lead_id) and t.emp_code = p_pageval;
                    */
                  select count(c.lead_id)
                    into v_fup_cnt
                    from tbl_crc_mst c
                   where c.followup_status > 0
                     and trunc(c.next_followup_date) = trunc(sysdate)
                     and to_char(c.next_fup_time) =
                         to_char(sysdate, 'HH24')
                     and c.emp_code = p_pageval
                     and c.intrested_status = 3
                     and c.lead_source_cat <> 202
                     and c.inserted_type <> 333;
                  if v_fup_cnt > 0 then
                    select max(c.lead_id)
                      into v_lead_id
                      from tbl_crc_mst c
                     where c.followup_status > 0
                       and trunc(c.next_followup_date) = trunc(sysdate)
                       and to_char(c.next_fup_time) =
                           to_char(sysdate, 'HH24')
                       and c.emp_code = p_pageval
                       and c.intrested_status = 3
                       and c.lead_source_cat <> 202
                       and c.inserted_type <> 333;
                    select t.mobile_number
                      into l_mob
                      from tbl_crc_mst t
                     where t.lead_id = v_lead_id;
                    select count(c.cust_id)
                      into v_cust_type
                      from customer c
                     where c.phone1 = to_char(l_mob)
                        or c.phone2 = to_char(l_mob);
                    open QRY_RESULT for
                      select '888' || 'µ' || t.lead_id || 'µ' ||
                             f.followup_id || 'µ' || t.cust_name || 'µ' ||
                             t.mobile_number || 'µ' || s.leadsource_name || 'µ' ||
                             t.product_name || 'µ' ||
                             TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                               when v_cust_type = 1 then
                                'Existing Customer'
                               else
                                'New Customer'
                             end || 'µ' || 'Follow Up Lead' || 'µ' ||
                             trunc(f.next_followup_date) || 'µ' ||
                             f.followup_reason || 'µ' || t.cust_mail || 'µ' ||
                             t.branch_id || 'µ' || b.branch_name || 'µ' ||
                             bb.buck_lang || 'µ' || bm.state_name
                        from tbl_crc_mst             t,
                             tbl_crc_followup_dtl    f,
                             tbl_leadsource_category s,
                             TBL_CRC_PRODUCTS        p,
                             branch_detail_new       b,
                             tbl_crc_bucksize        bb,
                             state_master            bm
                       where t.lead_source_cat = s.leadsource_id
                         and t.lead_id = f.lead_id
                         and b.branch_id = t.branch_id
                         and b.state_id = bm.state_id
                         and bb.bucket_id = t.bucket_id
                         and nvl(t.interested_product_id, t.product_id) =
                             p.products_id
                         and t.lead_id = v_lead_id
                         and t.followup_status > 0
                         and t.call_response_id > 1
                         and f.followup_id in
                             (select max(ff.followup_id)
                                from tbl_crc_followup_dtl ff
                               where ff.lead_id = v_lead_id)
                         and t.emp_code = p_pageval;
                  
                  else
                    ---------------------call back
                    select count(c.lead_id)
                      into v_fup_cnt
                      from tbl_crc_mst c
                     where c.followup_status > 0
                       and trunc(c.next_followup_date) <= trunc(sysdate)
                       and c.emp_code = p_pageval
                       and c.intrested_status = 3
                       and c.lead_source_cat <> 202
                       and c.inserted_type <> 333;
                  
                    if v_fup_cnt > 0 then
                      select max(c.lead_id)
                        into v_lead_id
                        from tbl_crc_mst c
                       where c.followup_status > 0
                         and trunc(c.next_followup_date) <= trunc(sysdate)
                         and c.emp_code = p_pageval
                         and c.intrested_status = 3
                         and c.lead_source_cat <> 202
                         and c.inserted_type <> 333;
                      select t.mobile_number
                        into l_mob
                        from tbl_crc_mst t
                       where t.lead_id = v_lead_id;
                      select count(c.cust_id)
                        into v_cust_type
                        from customer c
                       where c.phone1 = to_char(l_mob)
                          or c.phone2 = to_char(l_mob);
                      open QRY_RESULT for
                        select '888' || 'µ' || t.lead_id || 'µ' ||
                               f.followup_id || 'µ' || t.cust_name || 'µ' ||
                               t.mobile_number || 'µ' || s.leadsource_name || 'µ' ||
                               t.product_name || 'µ' ||
                               TO_CHAR(t.inserted_on,
                                       'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                                 when v_cust_type = 1 then
                                  'Existing Customer'
                                 else
                                  'New Customer'
                               end || 'µ' || 'Follow Up Lead' || 'µ' ||
                               trunc(f.next_followup_date) || 'µ' ||
                               f.followup_reason || 'µ' || t.cust_mail || 'µ' ||
                               t.branch_id || 'µ' || b.branch_name || 'µ' ||
                               bb.buck_lang || 'µ' || bm.state_name
                          from tbl_crc_mst             t,
                               tbl_crc_followup_dtl    f,
                               tbl_leadsource_category s,
                               TBL_CRC_PRODUCTS        p,
                               branch_detail_new       b,
                               tbl_crc_bucksize        bb,
                               state_master            bm
                         where t.lead_source_cat = s.leadsource_id
                           and t.lead_id = f.lead_id
                           and b.branch_id = t.branch_id
                           and b.state_id = bm.state_id
                           and bb.bucket_id = t.bucket_id
                           and nvl(t.interested_product_id, t.product_id) =
                               p.products_id
                           and t.lead_id = v_lead_id
                           and t.followup_status > 0
                           and t.call_response_id > 1
                           and f.followup_id in
                               (select max(ff.followup_id)
                                  from tbl_crc_followup_dtl ff
                                 where ff.lead_id = v_lead_id)
                           and t.emp_code = p_pageval;
                    
                    else
                      -----------------------------crm
                      --- Release lock  against employee
                      update tbl_crc_mst tt
                         set tt.emp_code = null
                       where tt.emp_code = p_pageval
                         and tt.followup_status = 0
                         and trunc(tt.inserted_on) <> trunc(sysdate);
                      select distinct count(t.lead_id)
                        into v_count1
                        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                       where t.bucket_id = e.bucket_id
                         and t.followup_status = 0
                         and t.emp_code is null
                         and e.emp_code = p_pageval
                         and t.lead_source_cat = 13
                         and t.inserted_type <> 333;
                      if v_count1 > 0 then
                        select nvl(max(t.lead_id), 0)
                          into v_lead_id
                          from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                         where t.bucket_id = e.bucket_id
                           and t.followup_status = 0
                           and t.emp_code is null
                           and t.lead_source_cat = 13
                           and t.inserted_type <> 333
                           and e.emp_code = p_pageval
                         order by t.inserted_type;
                        select t.mobile_number
                          into l_mob
                          from tbl_crc_mst t
                         where t.lead_id = v_lead_id;
                        select count(c.cust_id)
                          into v_cust_type
                          from customer c
                         where c.phone1 = to_char(l_mob)
                            or c.phone2 = to_char(l_mob);
                        -----Lock Lead against emp  & customer type update.
                        update TBL_CRC_MST t
                           set t.emp_code         = p_pageval,
                               t.emp_lock_tym     = sysdate,
                               t.customer_type_id = nvl(v_cust_type, 0),
                               t.log_empcode      = p_pageval
                         where t.lead_id = v_lead_id;
                        open QRY_RESULT for
                          select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
                                 t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                                 s.leadsource_name || 'µ' || t.product_name || 'µ' ||
                                 TO_CHAR(t.inserted_on,
                                         'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                                   when v_cust_type = 1 then
                                    'Existing Customer'
                                   else
                                    'New Customer'
                                 end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
                                 t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                                 b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                                 bm.state_name
                            from tbl_crc_mst             t,
                                 tbl_leadsource_category s,
                                 TBL_CRC_PRODUCTS        p,
                                 branch_detail_new       b,
                                 tbl_crc_bucksize        bb,
                                 state_master            bm
                           where t.lead_source_cat = s.leadsource_id
                             and t.product_id = p.products_id
                             and b.branch_id = t.branch_id
                             and b.state_id = bm.state_id
                             and bb.bucket_id = t.bucket_id
                             and t.lead_id = v_lead_id;
                      else
                        ---------------------lost customer
                        update TBL_CRC_MST tt
                           set tt.emp_code = null
                         WHERE tt.emp_code = p_pageval
                           and tt.followup_status = 0;
                        select distinct count(t.lead_id)
                          into v_count1
                          from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                         where t.bucket_id = e.bucket_id
                           and t.followup_status = 0
                           and t.emp_code is null
                           and e.emp_code = p_pageval
                           and t.lead_source_cat = 101
                           and t.inserted_type <> 333;
                        if v_count1 > 0 then
                          select nvl(max(t.lead_id), 0)
                            into v_lead_id
                            from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                           where t.bucket_id = e.bucket_id
                             and t.followup_status = 0
                             and t.emp_code is null
                             and t.lead_source_cat = 101
                             and t.inserted_type <> 333
                             and e.emp_code = p_pageval
                           order by t.inserted_type;
                          select t.mobile_number
                            into l_mob
                            from tbl_crc_mst t
                           where t.lead_id = v_lead_id;
                          select count(c.cust_id)
                            into v_cust_type
                            from customer c
                           where c.phone1 = to_char(l_mob)
                              or c.phone2 = to_char(l_mob);
                          -----Lock Lead against emp
                          update TBL_CRC_MST t
                             set t.emp_code         = p_pageval,
                                 t.emp_lock_tym     = sysdate,
                                 t.customer_type_id = nvl(v_cust_type, 0),
                                 t.log_empcode      = p_pageval
                           where t.lead_id = v_lead_id;
                        
                          --update TBL_CRC_MST t set t.emp_code =  p_pageval,t.customer_type_id = nvl(v_cust_type,0) where t.lead_id = v_lead_id ;
                          open QRY_RESULT for
                            select '1111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
                                   t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                                   s.leadsource_name || 'µ' ||
                                   t.product_name || 'µ' ||
                                   TO_CHAR(t.inserted_on,
                                           'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                                     when v_cust_type = 1 then
                                      'Existing Customer'
                                     else
                                      'New Customer'
                                   end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
                                   t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                                   b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                                   bm.state_name
                              from tbl_crc_mst             t,
                                   tbl_leadsource_category s,
                                   TBL_CRC_PRODUCTS        p,
                                   branch_detail_new       b,
                                   tbl_crc_bucksize        bb,
                                   state_master            bm
                             where t.lead_source_cat = s.leadsource_id
                               and t.product_id = p.products_id
                               and b.branch_id = t.branch_id
                               and b.state_id = bm.state_id
                               and bb.bucket_id = t.bucket_id
                               and t.lead_id = v_lead_id;
                        
                        else
                          ---------------------Redemption
                        
                          update TBL_CRC_MST tt
                             set tt.emp_code = null
                           WHERE tt.emp_code = p_pageval
                             and tt.followup_status = 0;
                          select distinct count(t.lead_id)
                            into v_count1
                            from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                           where t.bucket_id = e.bucket_id
                             and t.followup_status = 0
                             and t.emp_code is null
                             and e.emp_code = p_pageval
                             and t.lead_source_cat = 202
                             and t.inserted_type <> 333;
                          if v_count1 > 0 then
                            select nvl(max(t.lead_id), 0)
                              into v_lead_id
                              from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
                             where t.bucket_id = e.bucket_id
                               and t.followup_status = 0
                               and t.emp_code is null
                               and t.lead_source_cat = 202
                               and t.inserted_type <> 333
                               and e.emp_code = p_pageval
                             order by t.inserted_type;
                            select t.mobile_number
                              into l_mob
                              from tbl_crc_mst t
                             where t.lead_id = v_lead_id;
                            select count(c.cust_id)
                              into v_cust_type
                              from customer c
                             where c.phone1 = to_char(l_mob)
                                or c.phone2 = to_char(l_mob);
                          
                            -----Lock Lead against emp
                            update TBL_CRC_MST t
                               set t.emp_code         = p_pageval,
                                   t.emp_lock_tym     = sysdate,
                                   t.customer_type_id = nvl(v_cust_type, 0),
                                   t.log_empcode      = p_pageval
                             where t.lead_id = v_lead_id;
                            open QRY_RESULT for
                              select '2222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
                                     t.cust_name || 'µ' || t.mobile_number || 'µ' ||
                                     s.leadsource_name || 'µ' ||
                                     t.product_name || 'µ' ||
                                     TO_CHAR(t.inserted_on,
                                             'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                                       when v_cust_type = 1 then
                                        'Existing Customer'
                                       else
                                        'New Customer'
                                     end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
                                     t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                                     b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                                     bm.state_name
                                from tbl_crc_mst             t,
                                     tbl_leadsource_category s,
                                     TBL_CRC_PRODUCTS        p,
                                     branch_detail_new       b,
                                     tbl_crc_bucksize        bb,
                                     state_master            bm
                               where t.lead_source_cat = s.leadsource_id
                                 and t.product_id = p.products_id
                                 and b.branch_id = t.branch_id
                                 and b.state_id = bm.state_id
                                 and bb.bucket_id = t.bucket_id
                                 and t.lead_id = v_lead_id;
                          
                          else
                            ---------------------Redemption call/non contact
                            select count(c.lead_id)
                              into v_count1
                              from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
                             where c.followup_status not in (2, 0)
                               and e.emp_code = p_pageval
                               and nvl(c.lead_staus, 1) <> 0
                               and c.lead_source_cat = 202
                               and c.inserted_type <> 333;
                          
                            if v_count1 > 0 then
                              select nvl(min(c.lead_id), 0)
                                into v_lead_id
                                from tbl_crc_mst c
                               where c.followup_status not in (2, 0)
                                 and c.emp_code = p_pageval
                                 and nvl(c.lead_staus, 1) <> 0
                                 and c.lead_source_cat = 202
                                 and c.inserted_type <> 333;
                              select t.mobile_number
                                into l_mob
                                from tbl_crc_mst t
                               where t.lead_id = v_lead_id;
                              select count(c.cust_id)
                                into v_cust_type
                                from customer c
                               where c.phone1 = to_char(l_mob)
                                  or c.phone2 = to_char(l_mob);
                              open QRY_RESULT for
                                select '4444' || 'µ' || t.lead_id || 'µ' ||
                                       f.followup_id || 'µ' || t.cust_name || 'µ' ||
                                       t.mobile_number || 'µ' ||
                                       s.leadsource_name || 'µ' ||
                                       t.product_name || 'µ' ||
                                       TO_CHAR(t.inserted_on,
                                               'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                                         when v_cust_type = 1 then
                                          'Existing Customer'
                                         else
                                          'New Customer'
                                       end || 'µ' || 'Follow Up Lead' || 'µ' ||
                                       trunc(f.next_followup_date) || 'µ' ||
                                       f.followup_reason || 'µ' ||
                                       t.cust_mail || 'µ' || t.branch_id || 'µ' ||
                                       b.branch_name || 'µ' || bb.buck_lang || 'µ' ||
                                       bm.state_name
                                  from tbl_crc_mst             t,
                                       tbl_crc_followup_dtl    f,
                                       tbl_leadsource_category s,
                                       TBL_CRC_PRODUCTS        p,
                                       branch_detail_new       b,
                                       tbl_crc_bucksize        bb,
                                       state_master            bm
                                 where t.lead_source_cat = s.leadsource_id
                                   and t.lead_id = f.lead_id
                                   and b.branch_id = t.branch_id
                                   and b.state_id = bm.state_id
                                   and bb.bucket_id = t.bucket_id
                                   and nvl(t.interested_product_id,
                                           t.product_id) = p.products_id
                                   and t.lead_id = v_lead_id
                                   and t.followup_status > 0
                                   and t.emp_code = p_pageval
                                   and f.followup_id in
                                       (select max(ff.followup_id)
                                          from tbl_crc_followup_dtl ff
                                         where ff.lead_id = v_lead_id);
                            
                              -- else---------------------other campagin
                            
                            else
                            
                              open QRY_RESULT for
                                select '999' from dual;
                            
                            end if;
                          
                            --end if;
                          
                          end if;
                        
                        end if;
                      
                      end if;
                    
                    end if;
                  
                  end if;
                
                end if;
              
              end if;
            
            end if;
          
          end if;
        
        end if;
      
      end if;
    
    end if;
  
    ----------------------------------other campagin creation-----
  
  elsif p_flag = 'othercampagin_lead_call' then
    ------other compaign
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
    --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and t.emp_code is null and e.emp_code = p_pageval and t.inserted_by=222;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 333
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.inserted_type = 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'campagin_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'campagin_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'cmp_tdy_n_contact' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 333;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 333
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'cmp_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 333
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 333
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'campagin_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 333
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval
         and c.inserted_type = 333
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    --------------------------------------------------------------------------------------------------------------------------------------
  
  elsif p_flag = 'ch_othercmp_lead_call' then
    ------other compaign
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
    --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and t.emp_code is null and e.emp_code = p_pageval and t.inserted_by=222;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 333
       and t.intrested_status <> 3 /*and e.emp_code = p_pageval*/
       and t.other_camp_id = p_parval1;
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.inserted_type = 333 /*and e.emp_code = p_pageval*/
         and t.other_camp_id = p_parval1
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_cmp_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333
       and c.other_camp_id = p_parval1;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 333
         and c.other_camp_id = p_parval1;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_cmp_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333
       and c.other_camp_id = p_parval1;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 333
         and c.other_camp_id = p_parval1;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_cmp_tdynct' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 333
       and c.other_camp_id = p_parval1;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 333
         and c.other_camp_id = p_parval1
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_cmp_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 333
       and c.other_camp_id = p_parval1
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 333
         and c.other_camp_id = p_parval1
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_cmp_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.other_camp_id = p_parval1
       and c.inserted_type = 333
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval
         and c.other_camp_id = p_parval1
         and c.inserted_type = 333
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    --------------------------------------------------------------------------------------------------------------------------------------other campaign end
  
    --dm-------------------------misscall creation
  
  elsif p_flag = 'misscall_lead_call' then
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0
       and tt.lead_source_cat = 303;
    --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and t.emp_code is null and e.emp_code = p_pageval and t.inserted_by=222;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 303
       and t.lead_source_cat = 303
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.inserted_type = 303
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id) into v_cust_type from customer c where c.phone1 = to_char(l_mob) or c.phone2 =  to_char(l_mob);
      
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = 0,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      --open QRY_RESULT for  select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || t.product_name || 'µ' || TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || v_cust_type || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' || t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' || bb.buck_lang || 'µ' || bm.state_name from tbl_crc_mst t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'misscall_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303
       and c.lead_source_cat = 303; 
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 303
         and c.lead_source_cat = 303;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'misscall_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303
       and c.lead_source_cat = 303;
       
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 303
         and c.lead_source_cat = 303;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || 'nil' || 'µ' ||
               'nil' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || 'nil' || 'µ' ||
               bb.buck_lang || 'µ' || 'nil'
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'misscall_tdy_n_contact' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 303;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 303
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 303
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'misscall_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 303
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 303
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 303
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'misscall_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 303
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval
         and c.inserted_type = 303
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    ---dm-----------------------------------------------------------------------------------------------------------------------------------
  
  elsif p_flag = 'ch_misscall_lead_call' then
    ------miss call lead details assigining
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0
       and tt.lead_source_cat = 303;
    select count(distinct t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 303
       and t.intrested_status <> 3
       and e.emp_code = p_pageval; 
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.inserted_type = 303
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id) into v_cust_type from customer c where c.phone1 = to_char(l_mob) or c.phone2 =  to_char(l_mob);
     
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = 0,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_misscall_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303
       and c.lead_source_cat = 303; 
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 303
         and c.lead_source_cat = 303;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_misscall_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303
       and c.lead_source_cat = 303;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 303
         and c.lead_source_cat = 303;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || 'nil' || 'µ' ||
               'nil' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || 'nil' || 'µ' ||
               bb.buck_lang || 'µ' || 'nil'
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_misscall_tdy_n_contact' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 303; 
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 303
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 303 
         and nvl(c.lead_staus, 1) <> 0;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_misscall_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 303 
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 303
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 303 
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_misscall_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval 
       and c.inserted_type = 303
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval 
         and c.inserted_type = 303
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
    ------------------------miss call creation end
    
    -------------------------------------------------------RE lead calls
      --dm-------------------------RE lead call creation
  
  elsif p_flag = 'recall_lead_call' then
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0
       and tt.lead_source_cat = 45;
    --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and t.emp_code is null and e.emp_code = p_pageval and t.inserted_by=222;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 111
       and t.lead_source_cat = 45
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
          and t.lead_source_cat = 45
         and t.emp_code is null
         and t.inserted_type = 111
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id) into v_cust_type from customer c where c.phone1 = to_char(l_mob) or c.phone2 =  to_char(l_mob);
      
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = 0,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      --open QRY_RESULT for  select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || t.product_name || 'µ' || TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || v_cust_type || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' || t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' || bb.buck_lang || 'µ' || bm.state_name from tbl_crc_mst t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || m.branch_name|| 'µ' || bb.buck_lang || 'µ' || m.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               branch_detail_new       m,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and t.branch_id=m.branch_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'recall_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111
       and c.lead_source_cat = 45; 
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 111
         and c.lead_source_cat = 45;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'recall_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111
       and c.lead_source_cat = 45;
       
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 111
         and c.lead_source_cat = 45;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || 'nil' || 'µ' ||
               'nil' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || 'nil' || 'µ' ||
               bb.buck_lang || 'µ' || 'nil'
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'recall_tdy_n_contact' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 111;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 45
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 111
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'recall_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 111
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 45
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 111
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'recall_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 111
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval
         and c.inserted_type = 111
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    ---dm-----------------------------------------------------------------------------------------------------------------------------------
  
  elsif p_flag = 'ch_recall_lead_call' then
    ------RE call lead details assigining
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0
       and tt.lead_source_cat = 45;
    select count(distinct t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 111
       and t.intrested_status <> 3
       and e.emp_code = p_pageval; 
  
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.inserted_type = 111
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id) into v_cust_type from customer c where c.phone1 = to_char(l_mob) or c.phone2 =  to_char(l_mob);
     
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = 0,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_recall_tdy_fwlp' then
    ------today lead followup
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111
       and c.lead_source_cat = 45; 
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 111
         and c.lead_source_cat = 45;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' ||
               case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end  || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_recall_pend_fwlp' then
    ------pending lead followup
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111
       and c.lead_source_cat = 45;
    if v_count1 > 0 then
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) < trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type = 111
         and c.lead_source_cat = 45;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || 'nil' || 'µ' ||
               'nil' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || 'nil' || 'µ' ||
               bb.buck_lang || 'µ' || 'nil'
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_recall_tdy_n_contact' then
    ------today noncontact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 111; 
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 45
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 111 
         and nvl(c.lead_staus, 1) <> 0;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_recall_non_contact' then
    ------non contact
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 111 
       and c.intrested_status not in (2, 3);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.lead_source_cat = 45
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and c.emp_code = p_pageval
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and c.inserted_type = 111 
         and nvl(c.lead_staus, 1) <> 0;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'ch_recall_callback' then
    ------callback
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval 
       and c.inserted_type = 111
       and trunc(c.next_followup_date) <= trunc(sysdate);
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval 
         and c.inserted_type = 111
         and trunc(c.next_followup_date) <= trunc(sysdate);
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' || '' || 'µ' || '' || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || '' || 'µ' || '' || 'µ' || bb.buck_lang || 'µ' || ''
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               tbl_crc_bucksize        bb
         where t.lead_source_cat = s.leadsource_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
    ------------------------RE lead call creation end
  
  elsif p_flag = 'campaginbadge' then
    ---other campagin
    select distinct count(t.lead_id)
      into badge1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 333
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    ---today followup
    select count(c.lead_id)
      into badge2
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333;
  
    --pending followup
    select count(c.lead_id)
      into badge3
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 333;
  
    ---today non-contact
    select count(c.lead_id)
      into badge4
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 333;
  
    --Non contactable
    select count(c.lead_id)
      into badge5
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 333
       and c.intrested_status not in (2, 3);
  
    ----call back
    select count(c.lead_id)
      into badge6
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 333
       and trunc(c.next_followup_date) <= trunc(sysdate);
  
    open QRY_RESULT for
      select nvl(badge1, 0) || 'µ' || nvl(badge2, 0) || 'µ' ||
             nvl(badge3, 0) || 'µ' || nvl(badge4, 0) || 'µ' ||
             nvl(badge5, 0) || 'µ' || nvl(badge6, 0)
      
        from dual;
  
    --dm------------------------misscall
  elsif p_flag = 'misscallbadge' then
    ---misscall
    select distinct count(t.lead_id)
      into badge1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.lead_source_cat = 303
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 303
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    ---today followup
    select count(c.lead_id)
      into badge2
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and c.lead_source_cat = 303
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303;
  
    --pending followup
    select count(c.lead_id)
      into badge3
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and c.lead_source_cat = 303
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 303;
  
    ---today non-contact
    select count(c.lead_id)
      into badge4
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 303;
  
    --Non contactable
    select count(c.lead_id)
      into badge5
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 303
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 303
       and c.intrested_status not in (2, 3);
  
    ----call back
    select count(c.lead_id)
      into badge6
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 303
       and trunc(c.next_followup_date) <= trunc(sysdate);
  
    open QRY_RESULT for
      select nvl(badge1, 0) || 'µ' || nvl(badge2, 0) || 'µ' ||
             nvl(badge3, 0) || 'µ' || nvl(badge4, 0) || 'µ' ||
             nvl(badge5, 0) || 'µ' || nvl(badge6, 0)
      
        from dual;
  
    ---------------------
        --dm------------------------re leadcall
  elsif p_flag = 'recallbadge' then
    ---misscall
    select distinct count(t.lead_id)
      into badge14
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.lead_source_cat = 45
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.inserted_type = 111
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    ---today followup
    select count(c.lead_id)
      into badge15
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and c.lead_source_cat = 45
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111;
  
    --pending followup
    select count(c.lead_id)
      into badge16
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and c.lead_source_cat = 45
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type = 111;
  
    ---today non-contact
    select count(c.lead_id)
      into badge17
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type = 111;
  
    --Non contactable
    select count(c.lead_id)
      into badge18
      from tbl_crc_mst c
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat = 45
       and c.followup_status > 0
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.inserted_type = 111
       and c.intrested_status not in (2, 3);
  
    ----call back
    select count(c.lead_id)
      into badge19
      from tbl_crc_mst c
     where c.followup_status > 0
     and c.lead_source_cat = 45
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and c.inserted_type = 111
       and trunc(c.next_followup_date) <= trunc(sysdate);
  
    open QRY_RESULT for
      select nvl(badge14, 0) || 'µ' || nvl(badge15, 0) || 'µ' ||
             nvl(badge16, 0) || 'µ' || nvl(badge17, 0) || 'µ' ||
             nvl(badge18, 0) || 'µ' || nvl(badge19, 0)
      
        from dual;
  
    ---------------------re
  
  elsif p_flag = 'loadcampagindrop' then
    ----------load campaign dropdown
  
    open QRY_RESULT for
      select t.camp_id, upper(t.camp_na) from TBL_OTHER_CAMPGN_DTL t;
  
    -----------------------------------------------------------------------------------------------end----other campagin creation
  
  elsif p_flag = 'Today_Lead_Call' then
    --- Today Lead
  
    --- Release lock  against employee
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0
       and trunc(tt.inserted_on) = trunc(sysdate);
    --Today Lead call pending
  
    --select distinct count(t.bucket_id) into v_count from TBL_CRC_MST t, TBL_CRC_EMP_DTLS e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
    select distinct count(t.lead_id)
      into v_count
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) = trunc(sysdate)
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat in (8)
       and t.inserted_type <> 333;
  
    if v_count > 0 then
    
      -- -- LastInFirstOut Lead
      -- select nvl(max(t.lead_id), 0) into v_lead_id from TBL_CRC_MST t, TBL_CRC_EMP_DTLS e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval order by t.inserted_type ;
    
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and trunc(t.inserted_on) = trunc(sysdate)
         and t.emp_code is null
         and t.lead_source_cat in (8)
         and t.inserted_type <> 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.emp_lock_tym     = sysdate,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for select '111'|| 'µ'|| t.lead_id|| 'µ'||'0'||  'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'               ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
      open QRY_RESULT for
        select '111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'Today_Followup_Call' then
    --Today fresh followup pending
  
    select count(c.lead_id)
      into v_count1
      from TBL_CRC_MST c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type <> 333;
    --  select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) = trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1 group by f.lead_id having count(f.lead_id) >= 2);
  
    if v_count1 > 0 then
    
      -- -- LastInFirstOut Lead
      --select nvl(max(c.lead_id), 0) into v_lead_id from TBL_CRC_MST c where c.followup_status  = 1  and trunc(c.next_followup_date) = trunc(sysdate) and c.emp_code = p_pageval;
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.call_response_id < 2
         and c.intrested_status not in (2, 3)
         and trunc(c.next_followup_date) = trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type <> 333;
    
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -- open QRY_RESULT for select '222'|| 'µ'|| t.lead_id|| 'µ'||f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead'|| 'µ' || trunc(f.NEXT_FOLLOWUP_DATE) || 'µ' ||f.followup_reason|| 'µ'|| t.cust_mail from TBL_CRC_MST t, TBL_CRC_FOLLOWUP_DTL f,tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and trunc(t.next_followup_date) = trunc(f.NEXT_FOLLOWUP_DATE) and t.interested_product_id = p.products_id and t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '222' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and trunc(t.next_followup_date) = trunc(f.next_followup_date)
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'Non_Contactable_Call' then
    ------Non Contactable leads
  
    /*select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0   and c.intrested_status not in (2)  and c.emp_code = p_pageval and nvl(c.lead_staus,1) <> 0 ;
       if v_count1 > 0 then
                   select nvl(min(c.lead_id), 0)  into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.intrested_status not in (2)  and c.CALL_RESPONSE_ID > 1   and c.emp_code = p_pageval and nvl(c.lead_staus,1) <> 0 ;
                   select t.mobile_number into l_mob  from tbl_crc_mst t where t.lead_id = v_lead_id;
                   select count(c.cust_id) into v_cust_type from customer c where c.phone1 = l_mob or c.phone2 = l_mob ;
                   --open QRY_RESULT for  select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and t.product_id = p.products_id and t.lead_id = v_lead_id and t.followup_status > 0   and t.CALL_RESPONSE_ID > 1 and t.emp_code  = p_pageval;
                  open QRY_RESULT for  select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || TO_CHAR(t.inserted_on,'DD-MM-YYYY HH24:MI:SS') || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' || bb.buck_lang || 'µ' || bm.state_name from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and nvl(t.interested_product_id,t.product_id) = p.products_id and t.lead_id = v_lead_id and t.followup_status > 0 and t.call_response_id > 1 and t.emp_code = p_pageval and f.followup_id in(select max(ff.followup_id) from tbl_crc_followup_dtl ff where ff.lead_id = v_lead_id);
    
       else
                  open QRY_RESULT for select '666' from dual;
    
    end if;*/
  
    --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3);
    --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3);
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and (c.emp_code is null or c.emp_code = p_pageval)
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id not in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333
       and c.bucket_id = e.bucket_id
       and e.emp_code = p_pageval;
  
    if v_count1 > 0 then
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.intrested_status not in(2) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) < trunc(sysdate)) and c.lead_id not in (select distinct (mm.lead_id) from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.lead_id not in (select distinct t.lead_id from tbl_crc_mst t where t.followup_status > 0 and t.intrested_status = 3 and t.emp_code = p_pageval and trunc(t.next_followup_date) <= trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id not in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0  and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and (c.emp_code is null or c.emp_code =p_pageval) and c.lead_id not in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and (c.emp_code is null or c.emp_code = p_pageval)
         and c.lead_id not in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type <> 333
         and c.bucket_id = e.bucket_id
         and e.emp_code = p_pageval;
    
      update TBL_CRC_MST t
         set t.emp_code     = p_pageval,
             t.emp_lock_tym = sysdate,
             t.log_empcode  = p_pageval
       where t.lead_id = v_lead_id;
    
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           and t.call_response_id > 1
           and t.emp_code = p_pageval
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'Today_Non_Contactable_Call' then
    ------today Non Contactable leads
    --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.intrested_status not in(2) and c.emp_code = p_pageval and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
    --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3);
    --select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.lead_source_cat<>202 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2, 3);
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
     where c.CALL_RESPONSE_ID > 1
       and c.lead_source_cat <> 202
       and c.followup_status > 0
       and (c.emp_code is null or c.emp_code = p_pageval)
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in
           (select mm.lead_id as lead_id
              from TBL_CRC_FOLLOWUP_DTL mm
             where trunc(mm.inserted_on) = trunc(sysdate))
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333
       and c.bucket_id = e.bucket_id
       and e.emp_code = p_pageval;
    if v_count1 > 0 then
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.intrested_status not in(2) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and c.emp_code = p_pageval and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      --select nvl(min(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status > 0 and c.lead_source_cat<>202 and c.intrested_status not in(2,3) and c.CALL_RESPONSE_ID > 1 and (c.emp_code is null or c.emp_code =p_pageval) and c.lead_id in (select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and nvl(c.lead_staus, 1) <> 0;
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
       where c.followup_status > 0
         and c.lead_source_cat <> 202
         and c.intrested_status not in (2, 3)
         and c.CALL_RESPONSE_ID > 1
         and (c.emp_code is null or c.emp_code = p_pageval)
         and c.lead_id in
             (select mm.lead_id as lead_id
                from TBL_CRC_FOLLOWUP_DTL mm
               where trunc(mm.inserted_on) = trunc(sysdate))
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type <> 333
         and c.bucket_id = e.bucket_id
         and e.emp_code = p_pageval;
    
      update TBL_CRC_MST t
         set t.emp_code     = p_pageval,
             t.emp_lock_tym = sysdate,
             t.log_empcode  = p_pageval
       where t.lead_id = v_lead_id;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '999' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           and t.call_response_id > 1
           and t.emp_code = p_pageval
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'Pending_Lead_Call' then
    ------Pending_Lead_Call
    --- Release lock  against employee
    update tbl_crc_mst tt
       set tt.emp_code = null
     where tt.emp_code = p_pageval
       and tt.followup_status = 0
       and trunc(tt.inserted_on) <> trunc(sysdate);
  
    --- Pending call
    --  select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, tbl_crc_emp_dtls e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
    -----366371 select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval ;
    --select distinct count(t.lead_id) into v_count1 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval and t.lead_source_cat<>13;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <> trunc(sysdate)
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat in (8)
       and t.inserted_type <> 333;
  
    if v_count1 > 0 then
    
      -- -- LastInFirstOut Lead
      -- select nvl(max(t.lead_id), 0) into v_lead_id from tbl_crc_mst t, tbl_crc_emp_dtls e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
      -----366371select nvl(max(t.lead_id), 0) into v_lead_id from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval;
      --select nvl(max(t.lead_id), 0) into v_lead_id from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.emp_code is null and e.emp_code = p_pageval and t.lead_source_cat<>13;
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and trunc(t.inserted_on) <> trunc(sysdate)
         and t.emp_code is null
         and e.emp_code = p_pageval
         and t.lead_source_cat in (8)
         and t.inserted_type <> 333;
    
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.emp_lock_tym     = sysdate,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
    
      --select count(c.cust_id) into v_Cust_type from TBL_CRC_MST t, customer c where c.phone1 = to_char( t.mobile_number) or c.phone2 = to_char( t.mobile_number) and t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for select '444'|| 'µ'|| t.lead_id|| 'µ'||'0'||           'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'               ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
      open QRY_RESULT for
        select '444' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
    --------------------misscall
  elsif p_flag = 'miss_call' then
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.lead_source_cat = 303
       and c.followup_status = 0;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 0
         and c.lead_source_cat = 303;
    
      -- update TBL_CRC_MST t set t.emp_code =  p_pageval,t.emp_lock_tym=sysdate,t.log_empcode=p_pageval where t.lead_id = v_lead_id ;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select distinct '999' || 'µ' || t.lead_id || 'µ' || t.cust_name || 'µ' ||
                        t.mobile_number || 'µ' ||
                        TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ'
          from tbl_crc_mst t, branch_detail_new b, state_master bm
         where t.lead_id = v_lead_id
           and t.followup_status = 0;
    
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
    -----------------misscall
  
    --------------------------------------------------------------------------------------------------crm
  
  elsif p_flag = 'crm_lead_call' then
    ------crm
  
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
  
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat = 13
       and t.inserted_type <> 333;
  
    if v_count1 > 0 then
    
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.lead_source_cat = 13
         and t.inserted_type <> 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.emp_lock_tym     = sysdate,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for select '111'|| 'µ'|| t.lead_id|| 'µ'||'0'||  'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'               ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
      open QRY_RESULT for
        select '777' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  ---------------------------------------------------------ogl
  
   elsif p_flag = 'callback_ogl_call' then
    ------ogl
  
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
  
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat =505
       and t.inserted_type <> 333;
  
    if v_count1 > 0 then
    
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.lead_source_cat = 505
         and t.inserted_type <> 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.emp_lock_tym     = sysdate,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for select '111'|| 'µ'|| t.lead_id|| 'µ'||'0'||  'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'               ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
      open QRY_RESULT for
        select '10' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  --------------------------------------------------------ogl
  elsif p_flag = 'callback_lead_call' then
    ------callback
  
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status > 0
       and c.intrested_status = 3
       and c.emp_code = p_pageval
       and trunc(c.next_followup_date) <= trunc(sysdate)
       and c.inserted_type <> 333;
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status > 0
         and c.intrested_status = 3
         and c.emp_code = p_pageval
         and trunc(c.next_followup_date) <= trunc(sysdate)
         and c.inserted_type <> 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '888' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           and t.emp_code = p_pageval
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'lostcustomer_lead_call' then
    ------lostcustomer
  
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
  
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat = 101
       and t.inserted_type <> 333;
  
    if v_count1 > 0 then
    
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.lead_source_cat = 101
         and t.inserted_type <> 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.emp_lock_tym     = sysdate,
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for select '111'|| 'µ'|| t.lead_id|| 'µ'||'0'||  'µ'||  t.cust_name|| 'µ'  ||t.mobile_number|| 'µ'||s.leadsource_name|| 'µ'||p.products_name|| 'µ'               ||trunc(t.inserted_on)|| 'µ'||case when v_Cust_type = 1 then 'Existing Customer' else 'New Customer' end|| 'µ'||'Fresh Lead'|| 'µ'||'0' || 'µ'||'0'|| 'µ'||t.cust_mail from TBL_CRC_MST t, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.product_id = p.products_id and t.lead_id = v_lead_id ;
      --open QRY_RESULT for  select '1111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || 'Lost customer'/*s.leadsource_name*/ || 'µ' || p.products_name || 'µ' || TO_CHAR(t.inserted_on,'DD-MM-YYYY HH24:MI:SS') || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' || t.cust_mail|| 'µ' ||t.branch_id|| 'µ' ||b.branch_name|| 'µ' ||bb.buck_lang|| 'µ' ||bm.state_name from tbl_crc_mst t, /*tbl_leadsource_category s,*/ TBL_CRC_PRODUCTS p, branch_detail_new b, tbl_crc_bucksize bb, state_master bm where/* t.lead_source_cat = s.leadsource_id and */t.product_id = p.products_id and b.branch_id = t.branch_id and b.state_id = bm.state_id and bb.bucket_id = t.bucket_id and t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '1111' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'Redemption_lead_call' then
    ------Redemption
  
    update TBL_CRC_MST tt
       set tt.emp_code = null
     WHERE tt.emp_code = p_pageval
       and tt.followup_status = 0;
    select distinct count(t.lead_id)
      into v_count1
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and t.emp_code is null
       and e.emp_code = p_pageval
       and t.lead_source_cat = 202
       and t.inserted_type <> 333;
    if v_count1 > 0 then
      select nvl(max(t.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
       where t.bucket_id = e.bucket_id
         and t.followup_status = 0
         and t.emp_code is null
         and t.lead_source_cat = 202
         and t.inserted_type <> 333
         and e.emp_code = p_pageval
       order by t.inserted_type;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -----Lock Lead against emp
      update TBL_CRC_MST t
         set t.emp_code         = p_pageval,
             t.emp_lock_tym     = sysdate,
             t.customer_type_id = nvl(v_cust_type, 0),
             t.log_empcode      = p_pageval
       where t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '2222' || 'µ' || t.lead_id || 'µ' || '0' || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Fresh Lead' || 'µ' || '0' || 'µ' || '0' || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name||'µ'||dt.released_amnt||'µ'||dt.released_date||'µ'||dt.pledge_no||'µ'||dt.cust_id||'µ'||dt.inventry_count
          from tbl_crc_mst             t left outer join tbl_crc_redemtion_pldgdtl dt on(dt.lead_id=t.lead_id),
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.product_id = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id;
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'Redemption_non_callback' then
    ------Redemption noncontact/callback
  
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status not in (2, 0)
       and e.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 202
       and c.intrested_status = 3
       and c.inserted_type <> 333;
  
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status not in (2, 0)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.lead_source_cat = 202
         and c.intrested_status=3
         and c.inserted_type <> 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '4444' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name||'µ'||dt.released_amnt||'µ'||dt.released_date||'µ'||dt.pledge_no||'µ'||dt.cust_id||'µ'||dt.inventry_count
          from tbl_crc_mst             t left outer join tbl_crc_redemtion_pldgdtl dt on(dt.lead_id=t.lead_id),
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           and t.emp_code = p_pageval
           and t.intrested_status=3
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    ---------------------------------------------------------------------------------------------------crm
    
    -------------------------redemp non contact
    elsif p_flag = 'Redemption_non_contact' then
    ------Redemption noncontact
  
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status = 1
     and c.call_response_id > 1
     and c.bucket_id=e.bucket_id
       and e.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 202
       and c.inserted_type <> 333;
  
    if v_count1 > 0 then
      select nvl(min(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status = 1
     and c.call_response_id > 1
     and c.bucket_id=e.bucket_id
       and e.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 202
       and c.inserted_type <> 333;
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
      open QRY_RESULT for
        select '403' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name||'µ'||dt.released_amnt||'µ'||dt.released_date||'µ'||dt.pledge_no||'µ'||dt.cust_id||'µ'||dt.inventry_count
          from tbl_crc_mst             t left outer join tbl_crc_redemtion_pldgdtl dt on(dt.lead_id=t.lead_id),
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           --and f.emp_code = p_pageval
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    else
      open QRY_RESULT for
        select '666' from dual;
    end if;
      -------------------------redemp non contact
  
  
  elsif p_flag = 'Pending_Followup_Call' then
    ----- Pending Followup Lead call
  
    select count(c.lead_id)
      into v_count1
      from tbl_crc_mst c
     where c.followup_status = 1
       and c.intrested_status not in (2, 3)
       and c.call_response_id < 2
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.inserted_type <> 333;
    --  select count(c.lead_id) into v_count1 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) <> trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1 group by f.lead_id having count(f.lead_id) >= 2);
  
    if v_count1 > 0 then
    
      -- -- LastInFirstOut Lead
      --select nvl(max(c.lead_id), 0) into v_lead_id from tbl_crc_mst c where c.followup_status  = 1  and trunc(c.next_followup_date) <> trunc(sysdate) and c.emp_code = p_pageval;
      select nvl(max(c.lead_id), 0)
        into v_lead_id
        from tbl_crc_mst c
       where c.followup_status = 1
         and c.intrested_status not in (2, 3)
         and c.call_response_id < 2
         and trunc(c.next_followup_date) <> trunc(sysdate)
         and c.emp_code = p_pageval
         and nvl(c.lead_staus, 1) <> 0
         and c.inserted_type <> 333;
    
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      -- open QRY_RESULT for select '555' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and trunc(t.next_followup_date) = trunc(f.next_followup_date) and t.interested_product_id = p.products_id and t.lead_id = v_lead_id;
      open QRY_RESULT for
        select '555' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               TO_CHAR(t.inserted_on, 'DD-MM-YYYY HH24:MI:SS') || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and trunc(t.next_followup_date) = trunc(f.next_followup_date)
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
    
      open QRY_RESULT for
        select '666' from dual;
    
    end if;
  
  elsif p_flag = 'Call_initiated' then
  
    ---------------366371
    --select count(t.call_response_id) into v_Count from tbl_crc_followup_dtl t,(select max(t.followup_id) as  mx from tbl_crc_followup_dtl t  where t.lead_id=p_parval1 and t.emp_code=p_parval1 and t.call_response_id is null)x where t.followup_id=x.mx;
  
    select count(t.followup_id)
      into v_Count
      from tbl_crc_followup_dtl t
     where t.followup_id = (select max(t.followup_id)
                              from tbl_crc_followup_dtl t
                             where t.lead_id = p_parval1
                               and t.emp_code = p_pageval)
       and t.call_status is null;
  
    --select count(t.lead_id) into v_Count from tbl_crc_followup_dtl t where t.lead_id = p_parval1 and t.call_response_id is null;
    -------------366371
  
    if v_Count = 0 then
      v_next_fid := SEQ_CRC_LEAD_FOLLOWUP.nextval;
    
      select t.followup_status
        into follwup_status
        from tbl_crc_mst t
       where t.lead_id = p_parval1;
    
      insert into tbl_crc_followup_dtl
        (followup_id,
         lead_id,
         leadsource_id,
         followup_reason,
         -- FOLLOWUP_CATID,
         
         inserted_on,
         inserted_by,
         mobile,
         -- interested_products_id,
         customer_typeid,
         customer_email,
         FOLLOWUP_DATE,
         initial_mobile_no,
         emp_code,
         Process,
         CALL_INITIATED_TYM,
         NEXT_FOLLOWUP_DATE,
         LOG_EMPCODE)
        select v_next_fid,
               t.lead_id,
               t.lead_source_cat,
               -- follwup_status,
               p_parval2,
               
               sysdate,
               t.inserted_by,
               t.mobile_number,
               -- t.product_id,
               t.customer_type_id,
               t.cust_mail,
               sysdate,
               t.mobile_number,
               t.emp_code,
               2,
               sysdate,
               sysdate,
               t.log_empcode
          from tbl_crc_mst t
         where t.lead_id = p_parval1;
      --and t.emp_code = p_pageval;
    
      /* else
      
       select t.emp_code into empcode2 from tbl_crc_mst t where t.lead_id=p_parval1;
      update tbl_crc_followup_dtl t set t.inserted_on=sysdate t.emp_code=empcode2
       */
    end if;
  
    open QRY_RESULT for
      select '111' from dual;
    -----------------------------------------------------------------------------------------------------------------------
    ----------------------dilson
  
  elsif p_flag = 'personal_emp_pro' then
    open QRY_RESULT for
      select t.id, t.name from TBL_CRC_PERSONAL_DET1 t order by t.name;
  
    --------------------------dilson
  
  elsif p_flag = 'load_products' then
    open QRY_RESULT for
      select t.products_id, t.products_name
        from TBL_CRC_PRODUCTS t
       order by t.products_name;
  elsif p_flag = 'load_takeover_banknbfc' then
    open QRY_RESULT for
      select t.id, t.name from TBL_CRC_TAKEOVER_BANKNBFC t order by id;
  elsif p_flag = 'Redemption_f_status' then
    open QRY_RESULT for
      select t.followup_status_id, t.followup_status
        from TBL_CRC_FOLLOWUP_STATUS t
      where t.followup_status_id <> 2
       order by t.followup_status_id;
  elsif p_flag = 'Redem_release_reason' then
    open QRY_RESULT for
      select t.res_id, t.res_title
        from TBL_REDMPTN_RLS_RSN t
       order by t.res_id;
  elsif p_flag = 'getbucklanguage' then
    open QRY_RESULT for
      select distinct (t.col_lang_id), t.col_lang language_name
        from TBL_API_LOCAL_LANGUAGE t
       order by language_name;
  elsif p_flag = 'setlimit_lostcust' then
    v_splitter := splitstr(p_parval1, '^');
    update TBL_LOST_CUST_CALL_LIMIT t
       set t.buck_size = v_splitter(2)
     where t.lang_id = v_splitter(1);
    commit;
    open QRY_RESULT for
      select '111' from dual;
  elsif p_flag = 'addcampagincreation' then
    select count(t.camp_na)
      into v_count1
      from TBL_OTHER_CAMPGN_DTL t
     where upper(t.camp_na) = upper(p_parval1);
    if v_count1 > 0 then
      open QRY_RESULT for
        select '222' from dual;
    else
      select count(t.camp_id) into v_count1 from TBL_OTHER_CAMPGN_DTL t;
      v_count1 := v_count1 + 1;
      insert into TBL_OTHER_CAMPGN_DTL t values (v_count1, p_parval1);
      commit;
      open QRY_RESULT for
        select '111' from dual;
    end if;
    ------------------------------------------------------------------end 366371
  elsif p_flag = 'followup_status' then
    open QRY_RESULT for
      select t.followup_status_id, t.followup_status
        from TBL_CRC_FOLLOWUP_STATUS t
       where t.followup_status_id <> 4
       order by t.followup_status_id;
  elsif p_flag = 'get_branch_id' then
    open QRY_RESULT for
      select t.BRANCH_ID, t.BRANCH_ID || '-' || t.BRANCH_NAME
        from branch_dtl_new t
       where t.BRANCH_ID > = 0
       order by t.BRANCH_ID;
  elsif p_flag = 'branch_details' then
    open QRY_RESULT for
      select b.BRANCH_ID || 'µ' || b.area_name || 'µ' || b.reg_name || 'µ' ||
             m.branch_add1 || Chr(10) || m.branch_add2 || Chr(10) ||
             m.branch_add3 || Chr(10) || m.branch_add4 || Chr(10) ||
             m.branch_add5
        from branch_dtl_new b, branch_master m
       where b.BRANCH_ID = m.branch_id
         and b.BRANCH_ID = p_pageval;
  
  elsif p_flag = 'call_response' then
  
    if p_pageval = 0 then
      open QRY_RESULT for
        select t.response_id, t.response
          from tbl_CRC_Response t
         where t.response_id = 7
         order by t.response;
    else
      open QRY_RESULT for
        select t.response_id, t.response
          from tbl_CRC_Response t
         where t.response_id <> 7
         order by t.response;
    end if;
  
  elsif p_flag = 'Confirm' then
    --indata =  --type_selected +  resp_id +   Caller_ID + lead_id +  lead_followup_id + $("#txt_phn").val() + $("#txt_productIntrstd").val() + $("#ddl_followup").find('option:selected').val() + '^' + $("#txt_Email").val() + '^' + $("#txt_Branch_id").val() + '^' + $("#txt_flwup_date").val() + '^' + $("#txt_New_no").val() + '^' + $("#txt_Remarks").val()+ prd_status + '^'+bankndfc + '^'+redemp status+ '^'+ releasereson +'^'+ rating +'^'+ yesno ststus+ '^' + pl_weight + '^' + pl_amount +'^' +personal_loan
    -----             1            2             3               4            5                       6                                   7                                      8                                                  9                      10                     11                                12                                 13           14              15             16                  17             18             19                       20                  21            22
  
    v_next_fid := SEQ_CRC_LEAD_FOLLOWUP.nextval;
    v_splitter := splitstr(p_parval1, '^');
  
    --insert into mana0809.TBL_LEAD_MST (LEAD_ID,LEAD_SOURCE_CAT,CUT_NAME,MOBILE_NO,BRANCH_ID,LEAD_DATE,NEXT_FOLLOWUP_DATE,INSERTED_ON,LEAD_STATUS,PRODUCT_NAME,FOLLOWUP_STATUS,LEAD_PRIORITY,REQUIRED_AMNT)
    --                 values(SEQ_LEAD_ID,8,v_spliter_a(6),v_spliter_a(7),v_spliter_a(4),to_date(sysdate),to_date(sysdate),sysdate,0,' Gold Loan',0,' 3',v_spliter_a(17)) ;
  
    ---------------------------------lms----data----push
    select count(t.lead_id)
      into v_Count
      from TBL_CRC_MST t
     where t.lead_id = v_splitter(4)
       and t.lead_source_cat in (8)
       and t.followup_status = 0;
    if v_Count <> 0 then
      select t.cust_name,
             t.mobile_number,
             nvl(t.callcenter_comment, 'NIL'),
             t.branch_id,
             t.lead_date,
             t.product_name,
             t.cust_mail,
             nvl(t.required_amnt, 0),
             t.product_id
        into mst_name,
             mst_mobile,
             mst_comment,
             mst_branch,
             mst_leaddate,
             mst_proname,
             mst_mail,
             mst_reqamount,
             mst_prid
        from TBL_CRC_MST t
       where t.lead_id = v_splitter(4)
         and t.lead_source_cat in (8)
         and t.followup_status = 0;
    
      select count(*)
        into v_count1
        from tbl_lead_mst t
       where t.lead_source_cat in (8, 42)
         and t.mobile_no = mst_mobile
         and trunc(t.inserted_on) = trunc(sysdate);
    
      if v_count1 = 0 then
        if mst_prid = 21 then
          if mst_name is null then
            mst_name := 'NIL';
            insert into tbl_lead_mst t
              (t.lead_id,
               t.lead_source_cat,
               t.cut_name,
               t.mobile_no,
               t.remarks,
               t.branch_id,
               t.lead_date,
               t.next_followup_date,
               t.inserted_on,
               t.product_name,
               t.followup_status,
               t.customer_email,
               t.required_amnt,
               t.LEAD_STATUS,
               t.LEAD_PRIORITY)
            values
              (Lead_Management_seq.NEXTVAL,
               42,
               mst_name,
               mst_mobile,
               mst_comment,
               mst_branch,
               mst_leaddate,
               sysdate,
               sysdate,
               mst_proname,
               0,
               mst_mail,
               mst_reqamount,
               0,
               3);
          else
            insert into tbl_lead_mst t
              (t.lead_id,
               t.lead_source_cat,
               t.cut_name,
               t.mobile_no,
               t.remarks,
               t.branch_id,
               t.lead_date,
               t.next_followup_date,
               t.inserted_on,
               t.product_name,
               t.followup_status,
               t.customer_email,
               t.required_amnt,
               t.LEAD_STATUS,
               t.LEAD_PRIORITY)
            values
              (Lead_Management_seq.NEXTVAL,
               42,
               mst_name,
               mst_mobile,
               mst_comment,
               mst_branch,
               mst_leaddate,
               sysdate,
               sysdate,
               mst_proname,
               0,
               mst_mail,
               mst_reqamount,
               0,
               3);
          end if;
        
        else
          if mst_name is null then
            mst_name := 'NIL';
            insert into tbl_lead_mst t
              (t.lead_id,
               t.lead_source_cat,
               t.cut_name,
               t.mobile_no,
               t.remarks,
               t.branch_id,
               t.lead_date,
               t.next_followup_date,
               t.inserted_on,
               t.product_name,
               t.followup_status,
               t.customer_email,
               t.required_amnt,
               t.LEAD_STATUS,
               t.LEAD_PRIORITY)
            values
              (Lead_Management_seq.NEXTVAL,
               8,
               mst_name,
               mst_mobile,
               mst_comment,
               mst_branch,
               mst_leaddate,
               sysdate,
               sysdate,
               mst_proname,
               0,
               mst_mail,
               mst_reqamount,
               0,
               3);
          else
            insert into tbl_lead_mst t
              (t.lead_id,
               t.lead_source_cat,
               t.cut_name,
               t.mobile_no,
               t.remarks,
               t.branch_id,
               t.lead_date,
               t.next_followup_date,
               t.inserted_on,
               t.product_name,
               t.followup_status,
               t.customer_email,
               t.required_amnt,
               t.LEAD_STATUS,
               t.LEAD_PRIORITY)
            values
              (Lead_Management_seq.NEXTVAL,
               8,
               mst_name,
               mst_mobile,
               mst_comment,
               mst_branch,
               mst_leaddate,
               sysdate,
               sysdate,
               mst_proname,
               0,
               mst_mail,
               mst_reqamount,
               0,
               3);
          end if;
        
        end if;
      end if;
    end if;
  
    ---------------------------------------end lms data push
  
    select count(t.lead_id)
      into v_Count
      from TBL_CRC_MST t
     where t.lead_id = v_splitter(4)
       and t.mobile_number = v_splitter(6);
  
    if v_Count > 0 then
    
      /* select case when v_splitter(16)='ANSWERED' then 1
      when v_splitter(16) = 'NO ANSWER' then 0
      
          end  into disposition
      from dual;*/
    
      ------------
      select count(t.followup_id)
        into v_count1
        from tbl_crc_followup_dtl t
       where t.lead_id = v_splitter(4)
         and trunc(t.inserted_on) = trunc(sysdate);
    
      if v_count1 = 0 then
      
        insert into tbl_crc_followup_dtl
          (followup_id,
           lead_id,
           leadsource_id,
           inserted_on,
           inserted_by,
           mobile,
           -- interested_products_id,
           customer_typeid,
           customer_email,
           FOLLOWUP_DATE,
           initial_mobile_no,
           emp_code,
           Process,
           CALL_INITIATED_TYM,
           NEXT_FOLLOWUP_DATE,
           LOG_EMPCODE)
          select v_next_fid,
                 t.lead_id,
                 t.lead_source_cat,
                 sysdate,
                 t.inserted_by,
                 t.mobile_number,
                 -- t.product_id,
                 t.customer_type_id,
                 t.cust_mail,
                 sysdate,
                 t.mobile_number,
                 t.emp_code,
                 2,
                 sysdate,
                 sysdate,
                 t.log_empcode
            from tbl_crc_mst t
           where t.lead_id = v_splitter(4);
        commit;
      
      end if;
    
      ----------
    
      if v_splitter(2) = 1 or v_splitter(2) = 7 then
        ---Answered,Incoming
      
        select case
                 when to_date(to_char(to_date(v_splitter(11), 'yyyy-mm-dd'), 'DD-MON-YYYY')) -
                      to_date(sysdate) <= 1 then
                  1
                 when to_date(to_char(to_date(v_splitter(11), 'yyyy-mm-dd'), 'DD-MON-YYYY')) -
                      to_date(sysdate) <= 7 then
                  2
                 when to_date(to_char(to_date(v_splitter(11), 'yyyy-mm-dd'), 'DD-MON-YYYY')) -
                      to_date(sysdate) > 7 then
                  3
                 else
                  0
               end
          into l_priority
        
          from dual;
      
       
        
          --------------------------------------------------------------------------366371---------------------callback
        if v_splitter(16) = 'other' then
        
         ----anvi
           if v_splitter(8) = 1 then
          ---------------------------------------------------push data to takeover
        
          if v_splitter(7) = 26 then
            select count(t.lead_id)
              into v_Count
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
          
            select t.cust_name
              into T_custname
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
            select t.branch_id
              into T_branchid
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
            select t.mobile_number
              into T_mobilnumber
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
          
            select DBMS_RANDOM.STRING('R', 3) into v_takeOverid from dual;
            v_takeOverid := 'TAK' || v_takeOverid ||
                            lpad(DOOSTEP_TAKEOVER_ID.Nextval, 5, '0');
          
            insert into tbl_takeover_cust_req
              (take_req_id, branch_id, cust_name, mob_no, type_id)
            values
              (v_takeOverid, v_splitter(10), T_custname, T_mobilnumber, 2);
          
          end if;
          ------------------------------------------------------end
        
          ---------------------------------------------------------366371--------------productstatus  checking
          if v_splitter(14) = 1 then
          
            update tbl_crc_mst t
               set t.next_followup_date = to_char(to_date(v_splitter(11),
                                                          'yyyy-mm-dd'),
                                                  'DD-MON-YYYY'),
                   t.NEXT_FUP_TIME      = p_parval2,
                   
                   t.followup_status       = 1,
                   t.lead_priority         = l_priority,
                   t.callcenter_comment    = v_splitter(13),
                   t.call_response_id      = v_splitter(2),
                   t.intrested_status      = v_splitter(8),
                   t.interested_product_id = v_splitter(7),
                   t.FOLLOWUP_BRANCH_ID    = v_splitter(10),
                   t.mobile_number         = nvl(v_splitter(6),
                                                 t.mobile_number),
                   t.BANK_NBFC             = v_splitter(15),
                   t.pledge_weight         = v_splitter(20),
                   t.pledge_amount         = v_splitter(21),
                   --------------dilson
                   t.personal_l = v_splitter(22)
            ----------dilson
            
             where t.lead_id = v_splitter(4)
                  
               and t.mobile_number = v_splitter(6);
            commit;
          
            if v_splitter(9) is not null then
            
              update tbl_crc_mst t
                 set t.cust_mail = nvl(v_splitter(9), t.cust_mail)
               where t.lead_id = v_splitter(4)
                 and t.mobile_number = v_splitter(6);
              -- and t.emp_code = v_splitter(3);
              commit;
            end if;
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set f.next_followup_date     = to_char(to_date(v_splitter(11),
                                                                'yyyy-mm-dd'),
                                                        'DD-MON-YYYY'),
                     f.next_fup_time          = p_parval2,
                     f.branch_id              = v_splitter(10),
                     f.mobile                 = nvl(v_splitter(6), f.mobile),
                     f.interested_products_id = v_splitter(7),
                     f.call_response_id       = v_splitter(2),
                     f.CALL_CENTER_COMMENT    = v_splitter(13),
                     f.intrested_status       = v_splitter(8),
                     f.lead_priority          = l_priority,
                     f.BANK_NBFC              = v_splitter(15),
                     f.pledge_weight          = v_splitter(20),
                     f.pledge_amount          = v_splitter(21),
                     ---------------------dilson
                     f.personal_l      = v_splitter(22),
                     f.followup_reason = p_pageval
              -----------------------------
              
              /*,
              f.call_status = disposition,
              f.call_duration = to_char(round(v_splitter(15)/60 ,2 )), --to_char(to_number(v_splitter(15)/60)),
              f.call_response_date  = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
              commit;
            
              if v_splitter(9) is not null then
              
                update TBL_CRC_FOLLOWUP_DTL f
                   set f.customer_email = v_splitter(9)
                 where f.lead_id = v_splitter(4)
                   and f.followup_id = v_lead_followup_id
                   and trunc(f.inserted_on) = trunc(sysdate);
              end if;
            
            end if;
          
          else
          
            update tbl_crc_mst t
               set --t.next_followup_date = to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                   t.next_followup_date = NULL,
                   t.NEXT_FUP_TIME      = NULL,
                   -- t.cust_mail = nvl(v_splitter(9),t.cust_mail),
                   --  t.mobile_number =  nvl(v_splitter(6),t.mobile_number),
                   t.followup_status       = 1,
                   t.lead_priority         = l_priority,
                   t.callcenter_comment    = v_splitter(13),
                   t.call_response_id      = v_splitter(2),
                   t.intrested_status      = v_splitter(8),
                   t.interested_product_id = v_splitter(7),
                   t.FOLLOWUP_BRANCH_ID    = v_splitter(10),
                   t.mobile_number         = nvl(v_splitter(6),
                                                 t.mobile_number),
                   t.BANK_NBFC             = v_splitter(15),
                   t.pledge_weight         = v_splitter(20),
                   t.pledge_amount         = v_splitter(21)
                   -----------------------------------------dilson
                  ,
                   t.personal_l = v_splitter(22)
            
            -----------------------------------------dilson
            
            /*,
            t.call_status = disposition,
            t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
             where t.lead_id = v_splitter(4)
                  --and t.emp_code = v_splitter(3)
               and t.mobile_number = v_splitter(6);
            commit;
          
            if v_splitter(9) is not null then
            
              update tbl_crc_mst t
                 set t.cust_mail = nvl(v_splitter(9), t.cust_mail)
               where t.lead_id = v_splitter(4)
                 and t.mobile_number = v_splitter(6);
              -- and t.emp_code = v_splitter(3);
            end if;
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set --f.next_followup_date =  to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                     --f.next_fup_time = p_parval2,
                                   f.branch_id = v_splitter(10),
                     f.mobile                 = nvl(v_splitter(6), f.mobile),
                     f.interested_products_id = v_splitter(7),
                     f.call_response_id       = v_splitter(2),
                     f.CALL_CENTER_COMMENT    = v_splitter(13),
                     f.intrested_status       = v_splitter(8),
                     f.lead_priority          = l_priority,
                     f.BANK_NBFC              = v_splitter(15),
                     f.pledge_weight          = v_splitter(20),
                     f.pledge_amount          = v_splitter(21),
                     ----------------------------------------dilson
                     f.personal_l      = v_splitter(22),
                     f.followup_reason = p_pageval
              -------------------------------------dilson
              
              /*,
              f.call_status = disposition,
              f.call_duration = to_char(round(v_splitter(15)/60 ,2 )), --to_char(to_number(v_splitter(15)/60)),
              f.call_response_date  = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
              commit;
            
              if v_splitter(9) is not null then
              
                update TBL_CRC_FOLLOWUP_DTL f
                   set f.customer_email = v_splitter(9)
                 where f.lead_id = v_splitter(4)
                   and f.followup_id = v_lead_followup_id
                   and trunc(f.inserted_on) = trunc(sysdate);
              end if;
            
            end if;
          end if;
  
          else
          --- Not interested
        
          update tbl_crc_mst t
             set t.followup_status    = 1,
                 t.callcenter_comment = v_splitter(13),
                 t.call_response_id   = v_splitter(2),
                 t.intrested_status   = v_splitter(8) /*,
                                    t.call_status = disposition,
                                    t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
           where t.lead_id = v_splitter(4)
             and t.mobile_number = v_splitter(6);
          -- and t.emp_code = v_splitter(3);
        
          select max(t.followup_id)
            into v_lead_followup_id
            from tbl_crc_followup_dtl t
           where t.lead_id = v_splitter(4)
             and trunc(t.inserted_on) = trunc(sysdate);
        
          if v_lead_followup_id is not null then
          
            update tbl_crc_followup_dtl f
               set f.call_response_id    = v_splitter(2),
                   f.call_center_comment = v_splitter(13),
                   f.intrested_status    = v_splitter(8) /*,
                                               f.call_status = disposition ,
                                               f.call_response_date = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) ,
                                               f.call_duration =to_char(round(v_splitter(15)/60 ,2 )) --to_char(to_number(v_splitter(15)/60))*/
                   
                   --------------------------------------------log keeping
                  ,
                   f.followup_reason = p_pageval
            ---------------------------------------
            
             where f.lead_id = v_splitter(4)
               and f.followup_id = v_lead_followup_id
               and trunc(f.inserted_on) = trunc(sysdate);
          
          end if;
        end if;
        
          if v_splitter(8) = 1 then
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set f.next_followup_date  = to_char(to_date(v_splitter(11),
                                                             'yyyy-mm-dd'),
                                                     'DD-MON-YYYY'),
                     f.next_fup_time       = p_parval2,
                     f.call_response_id    = v_splitter(2),
                     f.CALL_CENTER_COMMENT = v_splitter(13),
                     f.intrested_status    = v_splitter(8),
                     f.lead_priority       = l_priority,
                     f.pledge_weight       = v_splitter(20),
                     f.pledge_amount       = v_splitter(21),
                     -----------------------------------366371 logkeeeping
                     f.followup_reason = p_pageval
              -----------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
              commit;
            
            end if;
          
          elsif v_splitter(8) = 3 or v_splitter(8) = 5 or v_splitter(8) = 6 then
            --- callback 3 not attended 5 intrested in future 6
          
            update tbl_crc_mst t
               set t.next_followup_date = to_char(to_date(v_splitter(11),
                                                          'yyyy-mm-dd'),
                                                  'DD-MON-YYYY'),
                   t.NEXT_FUP_TIME      = p_parval2,
                   t.call_response_id   = v_splitter(2),
                   t.followup_status    = 1,
                   t.lead_priority      = l_priority,
                   
                   t.callcenter_comment = v_splitter(13),
                   t.intrested_status   = v_splitter(8),
                   t.callback_status    = 1
            
             where t.lead_id = v_splitter(4)
               and t.mobile_number = v_splitter(6);
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set f.next_followup_date  = to_char(to_date(v_splitter(11),
                                                             'yyyy-mm-dd'),
                                                     'DD-MON-YYYY'),
                     f.next_fup_time       = p_parval2,
                     f.call_response_id    = v_splitter(2),
                     f.CALL_CENTER_COMMENT = v_splitter(13),
                     f.intrested_status    = v_splitter(8),
                     f.lead_priority       = l_priority,
                     
                     ---------------------------------log keeping
                     f.followup_reason = p_pageval
              -------------------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
            
            end if;
          
          elsif v_splitter(8) = 2 then
            ----------------not interest 09-12-21
          
            update tbl_crc_mst t
               set t.followup_status    = 1,
                   t.callcenter_comment = v_splitter(13),
                   t.call_response_id   = v_splitter(2),
                   t.intrested_status   = v_splitter(8) /*,
                                      t.call_status = disposition,
                                      t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
             where t.lead_id = v_splitter(4)
               and t.mobile_number = v_splitter(6);
            -- and t.emp_code = v_splitter(3);
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update tbl_crc_followup_dtl f
                 set f.call_response_id    = v_splitter(2),
                     f.call_center_comment = v_splitter(13),
                     f.intrested_status    = v_splitter(8) /*,
                                                 f.call_status = disposition ,
                                                 f.call_response_date = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) ,
                                                 f.call_duration =to_char(round(v_splitter(15)/60 ,2 )) --to_char(to_number(v_splitter(15)/60))*/
                     
                     -------------------------------------log keeping
                    ,
                     f.followup_reason = p_pageval
              -------------------------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
            
            end if;
          
          end if;
        
          -------------------------------------------------------------------end call back
        
          ---------------------------------------------------------366371-------------end-productstatus  checking
        
          --------------------------------------------------------------------------366371---------------------other redemption
        
        elsif v_splitter(16) = 'redemp' then
        
          if v_splitter(8) = 3 or v_splitter(8) = 5 or v_splitter(8) = 6 then
            --- callback
          
            update tbl_crc_mst t
               set --t.next_followup_date = to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                   --t.NEXT_FUP_TIME = p_parval2,
                       t.followup_status = 1,
                   t.lead_priority      = l_priority,
                   t.callcenter_comment = v_splitter(13),
                   t.intrested_status   = v_splitter(8),
                   t.callback_status    = 1
             where t.lead_id = v_splitter(4)
               and t.mobile_number = v_splitter(6);
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set --f.next_followup_date =  to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                     --f.next_fup_time = p_parval2,
                         f.call_response_id = v_splitter(2),
                     f.CALL_CENTER_COMMENT = v_splitter(13),
                     f.intrested_status    = v_splitter(8),
                     f.lead_priority       = l_priority,
                     
                     ------------------------log keepomg
                     
                     f.followup_reason = p_pageval
              -----------------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
            
            end if;
          
          elsif v_splitter(8) = 1 then
            --- other in redemption
          
            insert into TBL_CRC_REDMPTN_CALL_DTL
            values
              (v_splitter(4),
               v_splitter(6),
               1,
               v_splitter(17),
               v_splitter(13),
               v_splitter(18),
               v_splitter(19));
          
            update tbl_crc_mst t
               set t.followup_status    = 2,
                   t.lead_priority      = l_priority,
                   t.callcenter_comment = v_splitter(13),
                   t.intrested_status   = v_splitter(8)
             where t.lead_id = v_splitter(4)
               and t.mobile_number = v_splitter(6);
          commit;
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set --f.next_followup_date =  to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                     --f.next_fup_time = p_parval2,
                         f.call_response_id = v_splitter(2),
                     f.CALL_CENTER_COMMENT = v_splitter(13),
                     f.intrested_status    = v_splitter(8),
                     f.lead_priority       = l_priority,
                     ----------------------------------------logkeeping
                     f.followup_reason = p_pageval
              --------------------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
            commit;
            end if;
             else 
               
            ----------------not interest 09-12-21
          
            update tbl_crc_mst t
               set t.followup_status    = 1,
                   t.callcenter_comment = v_splitter(13),
                   t.call_response_id   = v_splitter(2),
                   t.intrested_status   = v_splitter(8) /*,
                                      t.call_status = disposition,
                                      t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
             where t.lead_id = v_splitter(4)
               and t.mobile_number = v_splitter(6);
            -- and t.emp_code = v_splitter(3);
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update tbl_crc_followup_dtl f
                 set f.call_response_id    = v_splitter(2),
                     f.call_center_comment = v_splitter(13),
                     f.intrested_status    = v_splitter(8) /*,
                                                 f.call_status = disposition ,
                                                 f.call_response_date = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) ,
                                                 f.call_duration =to_char(round(v_splitter(15)/60 ,2 )) --to_char(to_number(v_splitter(15)/60))*/
                     
                     -------------------------------------log keeping
                    ,
                     f.followup_reason = p_pageval
              -------------------------------------------
              
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
            
            end if;
          
          end if;
        
          -------------------------------------------------------------------end other in redemption
        
        else
          ----anvi
           if v_splitter(8) = 1 then
          ---------------------------------------------------push data to takeover
        
          if v_splitter(7) = 26 then
            select count(t.lead_id)
              into v_Count
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
          
            select t.cust_name
              into T_custname
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
            select t.branch_id
              into T_branchid
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
            select t.mobile_number
              into T_mobilnumber
              from TBL_CRC_MST t
             where t.lead_id = v_splitter(4);
          
            select DBMS_RANDOM.STRING('R', 3) into v_takeOverid from dual;
            v_takeOverid := 'TAK' || v_takeOverid ||
                            lpad(DOOSTEP_TAKEOVER_ID.Nextval, 5, '0');
          
            insert into tbl_takeover_cust_req
              (take_req_id, branch_id, cust_name, mob_no, type_id)
            values
              (v_takeOverid, v_splitter(10), T_custname, T_mobilnumber, 2);
          
          end if;
          ------------------------------------------------------end
        
          ---------------------------------------------------------366371--------------productstatus  checking
          if v_splitter(14) = 1 then
          
            update tbl_crc_mst t
               set t.next_followup_date = to_char(to_date(v_splitter(11),
                                                          'yyyy-mm-dd'),
                                                  'DD-MON-YYYY'),
                   t.NEXT_FUP_TIME      = p_parval2,
                   
                   t.followup_status       = 1,
                   t.lead_priority         = l_priority,
                   t.callcenter_comment    = v_splitter(13),
                   t.call_response_id      = v_splitter(2),
                   t.intrested_status      = v_splitter(8),
                   t.interested_product_id = v_splitter(7),
                   t.FOLLOWUP_BRANCH_ID    = v_splitter(10),
                   t.mobile_number         = nvl(v_splitter(6),
                                                 t.mobile_number),
                   t.BANK_NBFC             = v_splitter(15),
                   t.pledge_weight         = v_splitter(20),
                   t.pledge_amount         = v_splitter(21),
                   --------------dilson
                   t.personal_l = v_splitter(22)
            ----------dilson
            
             where t.lead_id = v_splitter(4)
                  
               and t.mobile_number = v_splitter(6);
            commit;
          
            if v_splitter(9) is not null then
            
              update tbl_crc_mst t
                 set t.cust_mail = nvl(v_splitter(9), t.cust_mail)
               where t.lead_id = v_splitter(4)
                 and t.mobile_number = v_splitter(6);
              -- and t.emp_code = v_splitter(3);
              commit;
            end if;
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set f.next_followup_date     = to_char(to_date(v_splitter(11),
                                                                'yyyy-mm-dd'),
                                                        'DD-MON-YYYY'),
                     f.next_fup_time          = p_parval2,
                     f.branch_id              = v_splitter(10),
                     f.mobile                 = nvl(v_splitter(6), f.mobile),
                     f.interested_products_id = v_splitter(7),
                     f.call_response_id       = v_splitter(2),
                     f.CALL_CENTER_COMMENT    = v_splitter(13),
                     f.intrested_status       = v_splitter(8),
                     f.lead_priority          = l_priority,
                     f.BANK_NBFC              = v_splitter(15),
                     f.pledge_weight          = v_splitter(20),
                     f.pledge_amount          = v_splitter(21),
                     ---------------------dilson
                     f.personal_l      = v_splitter(22),
                     f.followup_reason = p_pageval
              -----------------------------
              
              /*,
              f.call_status = disposition,
              f.call_duration = to_char(round(v_splitter(15)/60 ,2 )), --to_char(to_number(v_splitter(15)/60)),
              f.call_response_date  = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
              commit;
            
              if v_splitter(9) is not null then
              
                update TBL_CRC_FOLLOWUP_DTL f
                   set f.customer_email = v_splitter(9)
                 where f.lead_id = v_splitter(4)
                   and f.followup_id = v_lead_followup_id
                   and trunc(f.inserted_on) = trunc(sysdate);
              end if;
            
            end if;
          
          else
          
            update tbl_crc_mst t
               set --t.next_followup_date = to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                   t.next_followup_date = NULL,
                   t.NEXT_FUP_TIME      = NULL,
                   -- t.cust_mail = nvl(v_splitter(9),t.cust_mail),
                   --  t.mobile_number =  nvl(v_splitter(6),t.mobile_number),
                   t.followup_status       = 1,
                   t.lead_priority         = l_priority,
                   t.callcenter_comment    = v_splitter(13),
                   t.call_response_id      = v_splitter(2),
                   t.intrested_status      = v_splitter(8),
                   t.interested_product_id = v_splitter(7),
                   t.FOLLOWUP_BRANCH_ID    = v_splitter(10),
                   t.mobile_number         = nvl(v_splitter(6),
                                                 t.mobile_number),
                   t.BANK_NBFC             = v_splitter(15),
                   t.pledge_weight         = v_splitter(20),
                   t.pledge_amount         = v_splitter(21)
                   -----------------------------------------dilson
                  ,
                   t.personal_l = v_splitter(22)
            
            -----------------------------------------dilson
            
            /*,
            t.call_status = disposition,
            t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
             where t.lead_id = v_splitter(4)
                  --and t.emp_code = v_splitter(3)
               and t.mobile_number = v_splitter(6);
            commit;
          
            if v_splitter(9) is not null then
            
              update tbl_crc_mst t
                 set t.cust_mail = nvl(v_splitter(9), t.cust_mail)
               where t.lead_id = v_splitter(4)
                 and t.mobile_number = v_splitter(6);
              -- and t.emp_code = v_splitter(3);
            end if;
          
            select max(t.followup_id)
              into v_lead_followup_id
              from tbl_crc_followup_dtl t
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate);
          
            if v_lead_followup_id is not null then
            
              update TBL_CRC_FOLLOWUP_DTL f
                 set --f.next_followup_date =  to_char(to_date(v_splitter(11), 'yyyy-mm-dd'),'DD-MON-YYYY') ,
                     --f.next_fup_time = p_parval2,
                                   f.branch_id = v_splitter(10),
                     f.mobile                 = nvl(v_splitter(6), f.mobile),
                     f.interested_products_id = v_splitter(7),
                     f.call_response_id       = v_splitter(2),
                     f.CALL_CENTER_COMMENT    = v_splitter(13),
                     f.intrested_status       = v_splitter(8),
                     f.lead_priority          = l_priority,
                     f.BANK_NBFC              = v_splitter(15),
                     f.pledge_weight          = v_splitter(20),
                     f.pledge_amount          = v_splitter(21),
                     ----------------------------------------dilson
                     f.personal_l      = v_splitter(22),
                     f.followup_reason = p_pageval
              -------------------------------------dilson
              
              /*,
              f.call_status = disposition,
              f.call_duration = to_char(round(v_splitter(15)/60 ,2 )), --to_char(to_number(v_splitter(15)/60)),
              f.call_response_date  = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
               where f.lead_id = v_splitter(4)
                 and f.followup_id = v_lead_followup_id
                 and trunc(f.inserted_on) = trunc(sysdate);
              commit;
            
              if v_splitter(9) is not null then
              
                update TBL_CRC_FOLLOWUP_DTL f
                   set f.customer_email = v_splitter(9)
                 where f.lead_id = v_splitter(4)
                   and f.followup_id = v_lead_followup_id
                   and trunc(f.inserted_on) = trunc(sysdate);
              end if;
            
            end if;
          end if;
  
          else
          --- Not interested
        
          update tbl_crc_mst t
             set t.followup_status    = 1,
                 t.callcenter_comment = v_splitter(13),
                 t.call_response_id   = v_splitter(2),
                 t.intrested_status   = v_splitter(8) /*,
                                    t.call_status = disposition,
                                    t.call_response_date =to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
           where t.lead_id = v_splitter(4)
             and t.mobile_number = v_splitter(6);
          -- and t.emp_code = v_splitter(3);
        
          select max(t.followup_id)
            into v_lead_followup_id
            from tbl_crc_followup_dtl t
           where t.lead_id = v_splitter(4)
             and trunc(t.inserted_on) = trunc(sysdate);
        
          if v_lead_followup_id is not null then
          
            update tbl_crc_followup_dtl f
               set f.call_response_id    = v_splitter(2),
                   f.call_center_comment = v_splitter(13),
                   f.intrested_status    = v_splitter(8) /*,
                                               f.call_status = disposition ,
                                               f.call_response_date = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) ,
                                               f.call_duration =to_char(round(v_splitter(15)/60 ,2 )) --to_char(to_number(v_splitter(15)/60))*/
                   
                   --------------------------------------------log keeping
                  ,
                   f.followup_reason = p_pageval
            ---------------------------------------
            
             where f.lead_id = v_splitter(4)
               and f.followup_id = v_lead_followup_id
               and trunc(f.inserted_on) = trunc(sysdate);
          
          end if;
        end if;
        end if;
      
        open QRY_RESULT for
          select '111' from dual;
      
      else
        -- Not answered(Non Contactable)
      
        ---- Last followup details ( 2 time noncontactable as not a proper lead) updation
        select count(t.lead_id)
          into v_Count
          from TBL_CRC_FOLLOWUP_DTL t
         where t.lead_id = v_splitter(4);
      
        if v_Count > 0 then
        
          select nvl(t.call_response_id, 0)
            into v_Call_rep_id
            from tbl_crc_mst t
           where t.lead_id = v_splitter(4);
        
          v_response := 1;
        
          if v_Call_rep_id > 1 then
            --Non contactable
          
            v_response := 0; ---not a proper lead
          else
            v_response := 1; ---- Proper lead
          end if;
        
          update tbl_crc_mst t
             set t.call_response_id   = v_splitter(2),
                 t.followup_status    = 1,
                 t.callcenter_comment = v_splitter(13),
                 t.lead_staus         = v_response,
                 ------------------370156------106338
                 t.emp_code = null,
                 
                 ------------------end 370156------106338
                 
                 ----------------------------------------------edition 366371
                 t.intrested_status = 0
          -----------------------------------------------end----edition 366371
          /* t.call_status = disposition,
          t.call_response_date = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) */
           where t.lead_id = v_splitter(4)
             and t.mobile_number = v_splitter(6);
        
          select max(t.followup_id)
            into v_lead_followup_id
            from tbl_crc_followup_dtl t
           where t.lead_id = v_splitter(4)
             and trunc(t.inserted_on) = trunc(sysdate);
        
          if v_lead_followup_id is not null then
            update tbl_crc_followup_dtl t
               set t.call_response_id    = v_splitter(2),
                   t.call_center_comment = v_splitter(13),
                   
                   ------------log keepimg
                   t.followup_reason = p_pageval
            -------------------------------------------
            
            /*  t.call_status         = disposition,
            t.call_response_date  = to_date(v_splitter(14),'YYYY-MM-DD HH24:MI:SS' ) ,
            t.call_duration       =  to_char(round(v_splitter(15)/60 ,2 )) --to_char(to_number(v_splitter(15)/60))*/
             where t.lead_id = v_splitter(4)
               and trunc(t.inserted_on) = trunc(sysdate)
                  --and t.call_response_id is null
                  --and t.emp_code=null
                  
               and t.followup_id = v_lead_followup_id;
          
          end if;
        
        end if;
      end if;
    
    
         select count(t.followup_id) into v_Count from  TBL_CRC_FOLLOWUP_DTL t where t.lead_id = v_splitter(4)
                   and t.followup_id = v_lead_followup_id
                   and trunc(t.inserted_on) = trunc(sysdate) and t.call_uniqid  is not null;
               
         /* if v_Count=1 then
          
         open QRY_RESULT for
          select '111~'|| t.call_uniqid from  TBL_CRC_FOLLOWUP_DTL t where t.lead_id = v_splitter(4)
                   and t.followup_id = v_lead_followup_id
                   and trunc(t.inserted_on) = trunc(sysdate);
                   else*/
                       open QRY_RESULT for
                  select 111 from dual;
                  --end if;
        
    else
    
      open QRY_RESULT for
        select '~123' from dual;
    
    end if;
  
  elsif p_flag = 'call_hangup' then
  
    --indata =  lead_id + '^' +  mob_no;
    --- --          1            2
    --  p_parval2  =calldate + '^' + duration + '^' + disposition '^' + to_no;
    --                1                   2            3                 4
  
    v_splitter  := splitstr(p_parval1, '^');
    v_splitter2 := splitstr(p_parval2, '^');

  if v_splitter(2) = v_splitter2(4) then
  
    select t.lead_id
      into v_lead_id
      from tbl_crc_followup_dtl t
     where t.mobile = v_splitter(2)
       and trunc(t.inserted_on) = trunc(sysdate)
       and t.followup_id =
           (select max(f.followup_id)
              from tbl_crc_followup_dtl f
             where f.mobile = v_splitter(2));

      --select count(v_splitter(1)) into  v_Count from TBL_CRC_RESPONSE_CHK t where t.lead_id = v_splitter(1);
  --f v_Count=0 then
                  insert into TBL_CRC_RESPONSE_CHK values(v_lead_id,v_splitter(2),p_parval2,'nil',to_date(v_splitter2(1),'YYYY-MM-DD HH24:MI:SS'),v_splitter2(2),v_splitter2(3),v_splitter(3));
   ---- else 
    --  update TBL_CRC_RESPONSE_CHK t set t.resp2 = p_parval2 where t.mob_no=v_splitter(2);
   --end if;
     
     commit;
  
    select count(t.lead_id)
      into v_Count
      from TBL_CRC_MST t
     where t.lead_id = v_lead_id
       and t.mobile_number = v_splitter(2);
  
    if v_Count > 0 then
    
      select case
               when v_splitter2(3) = 'ANSWERED' then
                1
               when v_splitter2(3) = 'NO ANSWER' then
                0
               when v_splitter2(3) = 'BUSY' then
                2
               when v_splitter2(3) = 'FAILED' then
                3
               else
                4
             end
        into disposition
        from dual;
    
      update tbl_crc_mst t
         set t.call_status        = disposition,
             t.call_response_date = to_date(v_splitter2(1),
                                            'YYYY-MM-DD HH24:MI:SS')
       where t.lead_id = v_lead_id
         and t.mobile_number = v_splitter(2);
    
      select max(t.followup_id)
        into v_lead_followup_id
        from tbl_crc_followup_dtl t
       where t.lead_id = v_lead_id
         and trunc(t.inserted_on) = trunc(sysdate);
    
      if v_lead_followup_id is not null then
      
        update TBL_CRC_FOLLOWUP_DTL f
           set f.call_status        = disposition,
               f.call_duration      = --to_char(round(v_splitter2(2) / 60, 2)),
                                      to_char(to_date(v_splitter2(2),'sssss'),'mi:ss'),
               f.call_response_date = to_date(v_splitter2(1),
                                              'YYYY-MM-DD HH24:MI:SS')
         where f.lead_id = v_lead_id
           and f.followup_id = v_lead_followup_id
           and trunc(f.inserted_on) = trunc(sysdate);
      
      end if;
    
    end if;
   end if;
  
    open QRY_RESULT for
      select '111' from dual;
  
  elsif p_flag = 'Graph' then
  
    if p_pageval = 1 then
      -- Daily Performance
    
      open QRY_RESULT for
      
      select x.status, sum(x.cnt)
          from (select decode(f.call_res,
                              'ANSWERED',
                              'Total Call Answered',
                              'Todays Non Contactable') status,
                       count(*) cnt
                
                  from TBL_CRC_RESPONSE_CHK f
                
                 where  trunc(f.call_dt) = trunc(sysdate)
                   and f.call_res is not null
                   and f.emp_code = p_parval1
                
                 group by f.call_res
                union all
                select 'Todays Call Pending' status, count(*) cnt
                
                  from tbl_crc_mst t, tbl_crc_bucket_emp_dtl e
                
                 where t.bucket_id = e.bucket_id
                   and trunc(t.inserted_on) = trunc(sysdate)
                      
                   and e.emp_code = p_parval1
                   and t.followup_status = 0) x
         group by x.status
        having sum(x.cnt) > 0;
        
        
        
      /*
                          select x.status, sum(x.cnt)
                            from (select decode(t.call_response_id,
                                                1,
                                                'Total Call Answered',
                                                'Todays Non Contactable') status,
                                         count(*) cnt
      
                                    from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
      
                                   where t.bucket_id = e.bucket_id
                                     and trunc(t.inserted_on) = trunc(sysdate)
                                     and e.emp_code = p_parval1
                                     and t.followup_status = 1
                                   group by t.call_response_id
                                  union all
                                  select 'Todays Call Pending' status,
                                         count(*) cnt
      
                                    from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
      
                                   where t.bucket_id = e.bucket_id
                                     and trunc(t.inserted_on) = trunc(sysdate)
                                     and e.emp_code = p_parval1
                                     and t.followup_status = 0
      
                                  ) x
                           group by x.status
                           having sum(x.cnt)   >0;
      
      */
    
    elsif p_pageval = 2 then
      -- Monthly Performance
    
      open QRY_RESULT for
      
        select x.status, sum(x.cnt)
          from (select decode(f.call_res,
                              'ANSWERED',
                              'Current Month Call Answered',
                              'Current Month Non Contactable') status,
                       count(*) cnt
                
                   from TBL_CRC_RESPONSE_CHK f
                
                 where trunc(f.call_dt, 'MM') = trunc(sysdate, 'MM')
                   and f.emp_code = p_parval1
                   and f.call_res is not null
                 group by f.call_res
                union all
                select 'Current Month Call Pending' status, count(*) cnt
                
                  from tbl_crc_mst t, tbl_crc_bucket_emp_dtl e
                
                 where t.bucket_id = e.bucket_id
                   and trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
                   and e.emp_code = p_parval1
                   and t.followup_status = 0) x
        
         group by x.status
        having sum(x.cnt) > 0;
      /*    select X.status, sum(X.cnt)
      from (select decode(t.call_response_id,
                          1,
                          'Current Month Call Answered',
                          'Current Month Non Contactable') status,
                   count(*) cnt
      
              from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
      
             where t.bucket_id = e.bucket_id
               and trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
               and e.emp_code = p_parval1
               and t.followup_status = 1
             group by t.call_response_id
            union all
            select 'Current Month Call Pending' status, count(*) cnt
      
              from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
      
             where t.bucket_id = e.bucket_id
               and trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
               and e.emp_code = p_parval1
               and t.followup_status = 0
               )X
      
       group by X.status
       having sum(x.cnt)   >0;*/
    
    elsif p_pageval = 10 then
      -- Admin  Daily Performance
    
      open QRY_RESULT for
      
       select x.status, sum(x.cnt)
          from (select decode(f.call_res,
                              'ANSWERED',
                              'Total Call Answered',
                              'Todays Non Contactable') status,
                       count(*) cnt
                
                from TBL_CRC_RESPONSE_CHK f 
                
                 where trunc(f.call_dt) = trunc(sysdate)
                   and f.call_res is not null
                
                 group by f.call_res
                union all
                select 'Todays Call Pending' status, count(*) cnt
                
                  from tbl_crc_mst t, tbl_crc_bucket_emp_dtl e
                
                 where t.bucket_id = e.bucket_id
                   and trunc(t.inserted_on) = trunc(sysdate)
                      
                   and t.followup_status = 0) x
         group by x.status
        having sum(x.cnt) > 0;
    
      /*select x.status, sum(x.cnt)
       from (select decode(t.call_response_id,
                           1,
                           'Total Call Answered',
                           'Todays Non Contactable') status,
                    count(*) cnt
      
               from tbl_crc_mst t
      
              where trunc(t.inserted_on) = trunc(sysdate)
                and t.followup_status = 1
              group by t.call_response_id
             union all
             select 'Todays Call Pending' status,
                    count(*) cnt
      
               from tbl_crc_mst t
      
              where   trunc(t.inserted_on) = trunc(sysdate)
                and t.followup_status = 0
      
             ) x
      group by x.status
      having sum(x.cnt)   >0;*/
    
    elsif p_pageval = 20 then
      -- Admin Monthly Performance
    
      open QRY_RESULT for
      
        select x.status, sum(x.cnt)
          from (select decode(f.call_res,
                              'ANSWERED',
                              'Current Month Call Answered',
                              'Current Month Non Contactable') status,
                       count(*) cnt
                
                  from TBL_CRC_RESPONSE_CHK f 
                
                 where trunc(f.call_dt, 'MM') = trunc(sysdate, 'MM')
                   and f.call_res is not null
                
                 group by f.call_res
                union all
                select 'Current Month Call Pending' status, count(*) cnt
                
                  from tbl_crc_mst t, tbl_crc_bucket_emp_dtl e
                
                 where t.bucket_id = e.bucket_id
                   and trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
                      
                   and t.followup_status = 0) x
        
         group by x.status
        having sum(x.cnt) > 0;
    
      /* select X.status, sum(X.cnt)
      from (select decode(t.call_response_id,
                          1,
                          'Current Month Call Answered',
                          'Current Month Non Contactable') status,
                   count(*) cnt
      
              from tbl_crc_mst t
      
             where trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
               and t.followup_status = 1
             group by t.call_response_id
            union all
            select 'Current Month Call Pending' status, count(*) cnt
      
              from tbl_crc_mst t
      
             where trunc(t.inserted_on, 'MM') = trunc(sysdate, 'MM')
               and t.followup_status = 0
               )X
      
       group by X.status
       having sum(x.cnt)   >0;*/
    
    elsif p_pageval = 4 then
      -- Employee Attendance
      open QRY_RESULT for
        select t.col_language "Group", count(t.emp_code) "Attendance"
          from tbl_crc_bucket_emp_dtl t
         group by t.col_language;
    
    end if;
  
  elsif p_flag = 'drop_employees' then
    select t.post_id
      into v_post
      from TBL_CRC_EMP_DTLS t
     where t.emp_code = p_pageval;
    if v_post = 0 then
    
      open QRY_RESULT for
      
        select to_char(t.emp_code),
               to_char(t.emp_code) || '-' || t.emp_name
          from TBL_CRC_EMP_DTLS t
         where t.post_id <> 0;
    else
      open QRY_RESULT for
      
        select to_char(t.emp_code),
               to_char(t.emp_code) || '-' || t.emp_name
          from TBL_CRC_EMP_DTLS t 
         where t.emp_code = p_pageval;
    end if;
  
  elsif p_flag = 'badge' then
  
    -- Today lead call
  
    --select distinct count(t.lead_id) into badge1 from TBL_CRC_MST t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) = trunc(sysdate) and ( t.emp_code is null or t.emp_code = p_pageval )  and  e.emp_code = p_pageval and t.lead_source_cat<>13 ;
    select  count(distinct t.lead_id)
      into badge1
      from TBL_CRC_MST t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) = trunc(sysdate)
       and (t.emp_code is null or t.emp_code = p_pageval)
       and e.emp_code = p_pageval
       and t.lead_source_cat in (8)
       and t.inserted_type <> 333;
    --Today followup call
    -- select count(c.lead_id) into badge2 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) = trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1  group by f.lead_id having count(f.lead_id) >= 2);
    select count(c.lead_id)
      into badge2
      from TBL_CRC_MST c
     where c.followup_status = 1
       and trunc(c.next_followup_date) = trunc(sysdate)
       and c.call_response_id < 2
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333;
    --Non contactable
    -- select count(c.lead_id) into badge3 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0  and c.emp_code = p_pageval and nvl(c.lead_staus,1) <> 0   and c.intrested_status not in(2);
    -- select count(c.lead_id) into badge3 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) < trunc(sysdate)) and c.lead_id not in (select distinct t.lead_id from tbl_crc_mst t where t.followup_status > 0 and t.intrested_status = 3 and t.emp_code = p_pageval) and c.intrested_status not in (2);
    --select count(c.lead_id) into badge3 from tbl_crc_mst c where c.lead_source_cat<>202 and c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2,3) and c.inserted_type<>333;
    -- select count(c.lead_id) into badge3 from tbl_crc_mst c where c.lead_source_cat<>202 and c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id not in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2,3) and c.inserted_type<>333;
    select count(c.lead_id)
      into badge3
      from tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
     where c.lead_source_cat <> 202
       and c.CALL_RESPONSE_ID > 1
       and c.followup_status > 0
       and (c.log_empcode = p_pageval or c.emp_code = p_pageval)
       and nvl(c.lead_staus, 1) <> 0
       and not exists (select mm.lead_id as lead_id
              from mana0809.TBL_CRC_FOLLOWUP_DTL mm
             where mm.lead_id = c.lead_id
               and (trunc(mm.inserted_on) = trunc(sysdate) or
                   mm.call_response_id = 1))
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333
       and c.bucket_id = e.bucket_id
       and e.emp_code = p_pageval;
    --Pending call
    --select distinct count(t.lead_id) into badge4 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and ( t.emp_code is null or t.emp_code = p_pageval )  and e.emp_code = p_pageval and t.lead_source_cat<>13;
    select distinct count(t.lead_id)
      into badge4
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <> trunc(sysdate)
       and (t.emp_code is null or t.emp_code = p_pageval)
       and e.emp_code = p_pageval
       and t.lead_source_cat in (8)
       and t.inserted_type <> 333;
  
    --Pending followup call
    -- select count(c.lead_id) into badge5 from tbl_crc_mst c where c.followup_status = 1 and c.call_response_id < 2 and trunc(c.next_followup_date) <> trunc(sysdate) and c.emp_code = p_pageval and not exists(select f.lead_id from tbl_crc_followup_dtl f where c.lead_id = f.lead_id and f.call_response_id = 1 group by f.lead_id having count(f.lead_id) >= 2);
    select count(c.lead_id)
      into badge5
      from tbl_crc_mst c
     where c.followup_status = 1
       and trunc(c.next_followup_date) < trunc(sysdate)
       and c.call_response_id < 2
       and c.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333;
  
    ----crm lead call
    --  select distinct count(t.lead_id) into badge6 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.lead_source_cat=13 and t.intrested_status<>3 and e.emp_code = p_pageval;
    select distinct count(t.lead_id)
      into badge6
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.lead_source_cat = 13
       and t.inserted_type <> 333
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    ----call back
    
     ----ogl lead call
    --  select distinct count(t.lead_id) into badge6 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <> trunc(sysdate) and t.lead_source_cat=13 and t.intrested_status<>3 and e.emp_code = p_pageval;
    select distinct count(t.lead_id)
      into badge505
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.lead_source_cat = 505
       and t.inserted_type <> 333
       and t.intrested_status <> 3
       and e.emp_code = p_pageval;
  
    ----call back
    -- select distinct count(t.lead_id) into badge7 from tbl_crc_mst t  where t.followup_status > 0 and t.intrested_status = 3  and t.emp_code = p_pageval and trunc(t.next_followup_date) <= trunc(sysdate);
    -- select distinct count(t.lead_id) into badge7 from tbl_crc_mst t where t.followup_status > 0 and t.intrested_status = 3 and t.emp_code = p_pageval and t.lead_id not in( select distinct c.lead_id from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.intrested_status not in (2)) and trunc(t.next_followup_date) <= trunc(sysdate);
    select distinct count(t.lead_id)
      into badge7
      from tbl_crc_mst t
     where t.followup_status > 0
       and t.intrested_status = 3
       and t.emp_code = p_pageval
       and trunc(t.next_followup_date) <= trunc(sysdate)
       and t.inserted_type <> 333;
    ---today non-contact
    --select count(c.lead_id) into badge8 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in (2);
    --select count(c.lead_id) into badge8 from tbl_crc_mst c where c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.lead_id not in (select distinct t.lead_id from tbl_crc_mst t where t.followup_status > 0 and t.intrested_status = 3 and t.emp_code = p_pageval) and c.intrested_status not in (2);
    --select count(c.lead_id) into badge8 from tbl_crc_mst c where c.lead_source_cat<>202 and c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and c.emp_code = p_pageval and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in(2,3) and c.inserted_type<>333;
    --select count(c.lead_id) into badge8 from tbl_crc_mst c where c.lead_source_cat<>202 and c.CALL_RESPONSE_ID > 1 and c.followup_status > 0 and (c.emp_code is null or c.emp_code =p_pageval) and nvl(c.lead_staus, 1) <> 0 and c.lead_id in(select mm.lead_id as lead_id from TBL_CRC_FOLLOWUP_DTL mm where trunc(mm.inserted_on) = trunc(sysdate)) and c.intrested_status not in(2,3) and c.inserted_type<>333;
    select count(c.lead_id)
      into badge8
      from mana0809.tbl_crc_mst c, mana0809.TBL_CRC_BUCKET_emp_dtl e
     where c.lead_source_cat <> 202
       and c.CALL_RESPONSE_ID > 1
       and c.followup_status > 0
       and (c.emp_code is null or c.emp_code = p_pageval)
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_id in (select mm.lead_id as lead_id
                           from TBL_CRC_FOLLOWUP_DTL mm
                          where trunc(mm.inserted_on) = trunc(sysdate)
                            and mm.call_response_id <> 1)
       and c.intrested_status not in (2, 3)
       and c.inserted_type <> 333
       and c.bucket_id = e.bucket_id
       and e.emp_code = p_pageval;
  
    --lost customer
    select distinct count(t.lead_id)
      into badge9
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.lead_source_cat = 101
       and t.intrested_status <> 3
       and e.emp_code = p_pageval
       and t.inserted_type <> 333;
  
    --Redemption
    select  count(distinct t.lead_id)
      into badge10
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.followup_status = 0
       and trunc(t.inserted_on) <= trunc(sysdate)
       and t.lead_source_cat = 202
       and t.intrested_status <> 3
       and t.inserted_type <> 333
       and e.emp_code = p_pageval;
  
    ---other campagin
    --select distinct count(t.lead_id) into badge11 from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e where t.bucket_id = e.bucket_id and t.followup_status = 0 and trunc(t.inserted_on) <= trunc(sysdate) and t.inserted_by=222 and t.intrested_status<>3 and e.emp_code = p_pageval;
    select distinct count(t.lead_id)
      into badge11
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.inserted_type = 333
       and e.emp_code = p_pageval
       and nvl(t.lead_staus, 1) <> 0;
    --dm-----------------miss call
  
    select distinct count(t.lead_id)
      into badge303
      from tbl_crc_mst t, TBL_CRC_BUCKET_emp_dtl e
     where t.bucket_id = e.bucket_id
       and t.inserted_type = 303
       and t.lead_source_cat = 303
       and t.followup_status = 0
       and e.emp_code = p_pageval
       and nvl(t.lead_staus, 1) <> 0;
  
    -----------------
        --------------------redemption non contact
          select count(distinct c.lead_id)
     into badge403
      from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status = 1
     and c.call_response_id > 1
     and c.bucket_id=e.bucket_id
       and e.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 202
       and c.inserted_type <> 333;
    -----------------------------redemption non contact
    ---------redemption callback
    select count( distinct c.lead_id)
      into badge12
      from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status not in (2, 0)
       and e.emp_code = p_pageval
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 202
       and c.intrested_status=3
       and c.inserted_type <> 333;
       ----------------- RE leads
          select count( distinct c.lead_id)
      into badge13
      from tbl_crc_mst c, TBL_CRC_BUCKET_emp_dtl e
     where c.followup_status =0
       and e.emp_code = p_pageval
       and c.bucket_id=e.bucket_id
       and nvl(c.lead_staus, 1) <> 0
       and c.lead_source_cat = 45
       and c.inserted_type <> 333;
  ----------
    open QRY_RESULT for
    --select  nvl(badge1,0) || 'µ'|| nvl(badge2,0)   || 'µ'||   nvl(badge3,0) || 'µ'|| nvl(badge4,0) || 'µ'||nvl(badge5  ,0)|| 'µ'||nvl(badge7  ,0)
      select nvl(badge1, 0) || 'µ' || nvl(badge2, 0) || 'µ' ||
             nvl(badge3, 0) || 'µ' || nvl(badge4, 0) || 'µ' ||
             nvl(badge5, 0) || 'µ' || nvl(badge6, 0) || 'µ' ||
             nvl(badge7, 0) || 'µ' || nvl(badge8, 0) || 'µ' ||
             nvl(badge9, 0) || 'µ' || nvl(badge10, 0) || 'µ' ||
             nvl(badge11, 0) || 'µ' || nvl(badge12, 0) || 'µ' ||
             nvl(badge303, 0)|| 'µ' ||  nvl(badge403, 0)|| 'µ' ||  
             nvl(badge505, 0)|| 'µ' || nvl(badge13, 0)
      
        from dual;
  
  elsif p_flag = 'wallboard' then
    open QRY_RESULT for
      select count(t.lead_id) || 'µ' || sum(case
                                              when t.call_response_id = 1 and t.followup_status = 1 then
                                               1
                                              else
                                               0
                                            end) || 'µ' ||
             sum(case
                   when t.followup_status = 0 then
                    1
                   else
                    0
                 end) || 'µ' || sum(case
                                      when t.call_response_id > 1 then
                                       1
                                      else
                                       0
                                    end)
        from tbl_crc_mst t
       where trunc(t.inserted_on) = trunc(sysdate)
         and t.lead_source_cat <> 13;
  
  elsif p_flag = 'dashboard' then
    open QRY_RESULT for
      select (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t
                where trunc(t.inserted_on) = trunc(sysdate)
                  and t.lead_source_cat <> 13) || 'µ' ||
             
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t
                where trunc(t.inserted_on) between TRUNC(sysdate, 'iw') and
                      TRUNC(sysdate, 'iw') + 7 - 1 / 86400
                  and t.lead_source_cat <> 13) || 'µ' ||
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t
                where trunc(t.inserted_on) between TRUNC(sysdate, 'mm') and
                      LAST_DAY(TRUNC(sysdate, 'mm')) + 1 - 1 / 86400
                  and t.lead_source_cat <> 13) || 'µ' ||
             
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h
                where trunc(h.inserted_on) between TRUNC(sysdate, 'iw') and
                      TRUNC(sysdate, 'iw') + 7 - 1 / 86400
                  and h.lead_source_cat <> 13) || 'µ' ||
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h
                where trunc(h.inserted_on) between TRUNC(sysdate, 'mm') and
                      LAST_DAY(TRUNC(sysdate, 'mm')) + 1 - 1 / 86400
                  and h.lead_source_cat <> 13)
             
             -----------yesterday-----data
              || 'µ' ||
             
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t
                where trunc(t.inserted_on) = trunc(sysdate - 1)
                  and t.lead_source_cat <> 13) || 'µ' ||
             
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h
                where trunc(h.inserted_on) = TRUNC(sysdate) - 1
                  and h.lead_source_cat <> 13)
      --------------------------end yesterday data
      
        from dual;
  
    --Search missed call mobile no for call back
  
    -----------------------366371---------------------------------------------------------------------------------
  elsif p_flag = 'loadlocked_empcode' then
    open qry_result for
      select t.inserted_on,
             t.emp_code,
             dt.emp_name,
             t.mobile_number,
             m.buck_lang
        from mana0809.tbl_crc_mst      t,
             mana0809.tbl_crc_bucksize m,
             mana0809.tbl_crc_emp_dtls dt
       where trunc(t.inserted_on) <= trunc(sysdate)
         and t.lead_source_cat <> 13
         and t.followup_status = 0
         and m.bucket_id = t.bucket_id
         and dt.emp_code = t.emp_code
       order by t.inserted_on, m.buck_lang;
  elsif p_flag = 'unlock_empcode' then
    update mana0809.tbl_crc_mst t
       set t.emp_code = null
     where t.emp_code = p_pageval
       and t.mobile_number = p_parval1
       and trunc(t.inserted_on) <= trunc(sysdate);
    commit;
    open QRY_RESULT for
      select '111' from dual;
  
  elsif p_flag = 'loadlanguages' then
    open qry_result for
      select t.bucket_id, t.buck_lang from mana0809.tbl_crc_bucksize t;
  elsif p_flag = 'load_dashboardaname' then
    open qry_result for
      select t.flag_name, t.name
        from mana0809.TBL_CRC_DASHBOARD_NAME t
       order By t.id asc;
  elsif p_flag = 'display_dashboard' then
  
    proc_CRC_Dashboard(p_flag,
                       p_pageval,
                       p_parval1,
                       p_parval2,
                       p_parval3,
                       qry_result);
  
  elsif p_flag = 'hourlydashboard' then
  
    proc_CRC_Dashboard(p_flag,
                       p_pageval,
                       p_parval1,
                       p_parval2,
                       p_parval3,
                       qry_result);
  
  elsif p_flag = 'languagewisedashboard' then
  
    open qry_result for
      select (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(t.inserted_on) = trunc(sysdate)
                  and t.lead_source_cat <> 13
                  and k.bucket_id = t.bucket_id
                  and t.bucket_id = p_pageval
               
               ) || 'µ' ||
             
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(t.inserted_on) between TRUNC(sysdate, 'iw') and
                      TRUNC(sysdate, 'iw') + 7 - 1 / 86400
                  and t.lead_source_cat <> 13
                  and k.bucket_id = t.bucket_id
                  and t.bucket_id = p_pageval
               
               ) || 'µ' ||
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(t.inserted_on) between TRUNC(sysdate, 'mm') and
                      LAST_DAY(TRUNC(sysdate, 'mm')) + 1 - 1 / 86400
                  and t.lead_source_cat <> 13
                  and k.bucket_id = t.bucket_id
                  and t.bucket_id = p_pageval) || 'µ' ||
             
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(h.inserted_on) between TRUNC(sysdate, 'iw') and
                      TRUNC(sysdate, 'iw') + 7 - 1 / 86400
                  and h.lead_source_cat <> 13
                  and k.bucket_id = h.bucket_id
                  and h.bucket_id = p_pageval
               
               ) || 'µ' ||
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(h.inserted_on) between TRUNC(sysdate, 'mm') and
                      LAST_DAY(TRUNC(sysdate, 'mm')) + 1 - 1 / 86400
                  and h.lead_source_cat <> 13
                  and k.bucket_id = h.bucket_id
                  and h.bucket_id = p_pageval)
             -----------yesterday-----data
              || 'µ' ||
             
              (select count(t.lead_id) || 'µ' ||
                      sum(case
                            when t.call_response_id = 1 then
                             1
                            else
                             0
                          end) || 'µ' || sum(case
                                               when t.followup_status = 0 then
                                                1
                                               else
                                                0
                                             end) || 'µ' ||
                      sum(case
                            when t.call_response_id > 1 then
                             1
                            else
                             0
                          end)
                 from mana0809.tbl_crc_mst t, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(t.inserted_on) = trunc(sysdate - 1)
                  and t.lead_source_cat <> 13
                  and k.bucket_id = t.bucket_id
                  and t.bucket_id = p_pageval) || 'µ' ||
             
              (select count(h.lead_id)
                 from mana0809.tbl_crc_mst_his h, mana0809.TBL_CRC_BUCKSIZE k
                where trunc(h.inserted_on) = trunc(sysdate) - 1
                  and h.lead_source_cat <> 13
                  and k.bucket_id = h.bucket_id
                  and h.bucket_id = p_pageval
               
               )
      --------------------------end yesterday data
      
        from dual;
  
    -----------------------366371---------------------------------------------------------------------------------
  elsif p_flag = 'search_no' then
  
    select count(t.lead_id)
      into v_count
      from tbl_crc_mst t
     where t.mobile_number = p_parval1;
  
    if v_count > 0 then
    
      select max(t.lead_id)
        into v_lead_id
        from tbl_crc_mst t
       where t.mobile_number = p_parval1;
    
      select t.mobile_number
        into l_mob
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = to_char(l_mob)
          or c.phone2 = to_char(l_mob);
    
      /*  select
      from tbl_crc_ftbl_crc_followup_dtl f
      where f.l
         */
    
      -- open QRY_RESULT for  select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail from tbl_crc_mst t, tbl_crc_followup_dtl f, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and t.lead_id = f.lead_id and t.product_id = p.products_id and t.lead_id = v_lead_id and t.followup_status > 0  and t.mobile_number = p_parval1 ;
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               trunc(t.inserted_on) || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.state_name
          from tbl_crc_mst             t,
               tbl_crc_followup_dtl    f,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS        p,
               branch_detail_new       b,
               tbl_crc_bucksize        bb,
               state_master            bm
         where t.lead_source_cat = s.leadsource_id
           and t.lead_id = f.lead_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.state_id
           and bb.bucket_id = t.bucket_id
           and t.lead_id = v_lead_id
           and t.followup_status > 0
           and t.mobile_number = p_parval1
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
      -- no lead found
    
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
    ---- incoming call trace
  
  elsif p_flag = 'incoming' then
  
    select count(t.lead_id)
      into v_count
      from tbl_crc_mst t
     where t.mobile_number = p_parval1;
  
    if v_count > 0 then
    
      select max(t.lead_id)
        into v_lead_id
        from tbl_crc_mst t
       where t.mobile_number = p_parval1;
    
      -- select count(c.cust_id) into v_Cust_type from TBL_CRC_MST t, customer c where c.phone1 = to_char( t.mobile_number) or c.phone2 = to_char( t.mobile_number)  and t.lead_id = v_lead_id;
      select count(c.cust_id)
        into v_cust_type
        from customer c
       where c.phone1 = p_parval1
          or c.phone2 = p_parval1;
    
      ---- entry for first followup
    
      v_next_fid := SEQ_CRC_LEAD_FOLLOWUP.nextval;
    
      select t.followup_status
        into follwup_status
        from tbl_crc_mst t
       where t.lead_id = v_lead_id;
    
      insert into tbl_crc_followup_dtl
        (followup_id,
         lead_id,
         leadsource_id,
         -- FOLLOWUP_CATID,
         
         inserted_on,
         inserted_by,
         mobile,
         -- interested_products_id,
         customer_typeid,
         customer_email,
         FOLLOWUP_DATE,
         initial_mobile_no,
         emp_code,
         Process,
         CALL_INITIATED_TYM,
         NEXT_FOLLOWUP_DATE)
        select v_next_fid,
               t.lead_id,
               t.lead_source_cat,
               -- follwup_status,
               
               sysdate,
               t.inserted_by,
               t.mobile_number,
               -- t.product_id,
               t.customer_type_id,
               t.cust_mail,
               sysdate,
               t.mobile_number,
               p_pageval,
               1,
               sysdate,
               sysdate
          from tbl_crc_mst t
         where t.lead_id = v_lead_id;
    
      -- open QRY_RESULT for    select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' || t.cust_name || 'µ' || t.mobile_number || 'µ' || s.leadsource_name || 'µ' || p.products_name || 'µ' || trunc(t.inserted_on) || 'µ' || case when v_cust_type = 1 then 'Existing Customer' else 'New Customer' end || 'µ' || 'Follow Up Lead' || 'µ' || trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' || t.cust_mail from tbl_crc_mst t, tbl_crc_followup_dtl f,(select max(f1.followup_id) as max_f_id, f1.lead_id from tbl_crc_followup_dtl f1 group by f1.lead_id) fd, tbl_leadsource_category s, TBL_CRC_PRODUCTS p where t.lead_source_cat = s.leadsource_id and fd.max_f_id = f.followup_id and f.lead_id = fd.lead_id and t.lead_id = f.lead_id and t.product_id = p.products_id and t.lead_id = v_lead_id and t.mobile_number = p_parval1;
      open QRY_RESULT for
        select '333' || 'µ' || t.lead_id || 'µ' || f.followup_id || 'µ' ||
               t.cust_name || 'µ' || t.mobile_number || 'µ' ||
               s.leadsource_name || 'µ' || t.product_name || 'µ' ||
               trunc(t.inserted_on) || 'µ' || case
                 when v_cust_type = 1 then
                  'Existing Customer'
                 else
                  'New Customer'
               end || 'µ' || 'Follow Up Lead' || 'µ' ||
               trunc(f.next_followup_date) || 'µ' || f.followup_reason || 'µ' ||
               t.cust_mail || 'µ' || t.branch_id || 'µ' || b.branch_name || 'µ' ||
               bb.buck_lang || 'µ' || bm.STATE_NAME
          from tbl_crc_mst t,
               tbl_crc_followup_dtl f,
               (select max(f1.followup_id) as max_f_id, f1.lead_id
                  from tbl_crc_followup_dtl f1
                 group by f1.lead_id) fd,
               tbl_leadsource_category s,
               TBL_CRC_PRODUCTS p,
               branch_detail_new b,
               tbl_crc_bucksize bb,
               state_master bm
         where t.lead_source_cat = s.leadsource_id
           and fd.max_f_id = f.followup_id
           and f.lead_id = fd.lead_id
           and b.branch_id = t.branch_id
           and b.state_id = bm.STATE_ID
           and bb.bucket_id = t.bucket_id
           and t.lead_id = f.lead_id
           and nvl(t.interested_product_id, t.product_id) = p.products_id
           and t.lead_id = v_lead_id
           and t.mobile_number = p_parval1
           and f.followup_id in
               (select max(ff.followup_id)
                  from tbl_crc_followup_dtl ff
                 where ff.lead_id = v_lead_id);
    
    else
      -- no lead found
    
      open QRY_RESULT for
        select '666' from dual;
    end if;
  
  elsif p_flag = 'get_extension_no' then
    open QRY_RESULT for
      select t.did_no, t.post_id
        from tbl_crc_emp_dtls t
       where t.emp_code = p_pageval;
  
    ----------------------CRF_106388----- 370156 -----------------------------------------------------
  elsif p_flag = 'foll_from_empcode' then
    --today follow up empcode
    open QRY_RESULT for
      select distinct (t.emp_code), e.emp_name
        from TBL_CRC_MST t, tbl_crc_emp_dtls e
       where t.followup_status = 1
         and trunc(t.next_followup_date) = trunc(sysdate)
         and t.emp_code = e.emp_code;
  
  elsif p_flag = 'foll_from_buck_id' then
    open QRY_RESULT for
      select distinct (t.bucket_id)
        from TBL_CRC_MST t
       where t.emp_code = p_parval1;
  
  elsif p_flag = 'foll_to_empcode' then
    v_splitter := splitstr(p_parval1, '^');
    --open QRY_RESULT for select distinct(t.emp_code), e.emp_name from TBL_CRC_MST t, tbl_crc_emp_dtls e where t.followup_status = 1 and t.emp_code = e.emp_code and t.emp_code <> v_splitter(1) and t.bucket_id = v_splitter(2);
    open QRY_RESULT for
      select distinct (t.emp_code), e.emp_name
        from TBL_CRC_BUCKET_EMP_DTL t, tbl_crc_emp_dtls e
       where t.emp_code = e.emp_code
         and t.emp_code <> v_splitter(1)
         and t.bucket_id = v_splitter(2);
  
  elsif p_flag = 'foll_to_submit' then
    v_splitter := splitstr(p_parval1, '^');
    select distinct (t.bucket_id)
      into bkid
      from TBL_CRC_MST t
     where t.emp_code = v_splitter(1);
  
    update tbl_crc_mst t
       set t.emp_code = v_splitter(2)
     where t.emp_code = v_splitter(1)
       and t.bucket_id = bkid
       and trunc(t.next_followup_date) = trunc(sysdate)
       and t.followup_status <> 0;
    open QRY_RESULT for
      select '111' from dual;
  
    ----------------------end CRF_106388----- 370156 -----------------------------------------------------
  
    -----------------------CRF_login_376292,376328-----------------------------------------------------------
  elsif p_flag = 'insert_login_time' then
    select e.emp_name
      into empname1
      from employee_master e
     where e.emp_code = p_parval1;
  
    insert into tbl_crc_itcportal_login t
      (t.employee_code, t.employee_name, t.login_date_time)
    values
      (p_parval1, empname1, sysdate);
  
    -----------------------end CRF_login_376292,376328-----------------------------------------------------------
    -----------------------crf_logout_376292,376328-----------------------------------------------------------
  elsif p_flag = 'insert_logout_time' then
    select e.emp_name
      into empname1
      from employee_master e
     where e.emp_code = p_parval1;
  
    update tbl_crc_itcportal_login
       set logout_time = sysdate
     where employee_name = empname1;
    -----------------------end CRF_logout_376292,376328-----------------------------------------------------------
    -----------------------crf_break_376292,376328-----------------------------------------------------------
  elsif p_flag = 'realtimemon' then
    open QRY_RESULT for
      select distinct lo.employee_code,
                      l.emp_name,
                      l.col_language,
                      case
                        when x.available is null and x.max_dt is not null and
                             lo.logout_time is null then
                         1
                        else
                         0
                      end break,
                      case
                        when x.available is not null and x.max_dt is not null and
                             lo.logout_time is null then
                         1
                        else
                         0
                      end availabel,
                      case
                        when sysdate > y.max_dt1 + interval '12'
                         minute and lo.logout_time is null then
                         1
                        else
                         0
                      end Idle_,
                      case
                        when lo.login_date_time is not null and lo.logout_time is not null then
                         1
                        else
                         0
                      end Logout
        from (SELECT t1.employee_code, t1.login_date_time, t1.logout_time
                FROM mana0809.tbl_crc_itcportal_login t1
               INNER JOIN (SELECT t2.employee_code,
                                 max(t2.login_date_time) AS job_start
                            FROM mana0809.tbl_crc_itcportal_login t2
                           GROUP BY t2.employee_code) t2
                  ON t1.employee_code = t2.employee_code
                 AND t1.login_date_time = t2.job_start) lo
        left outer join (select d.employee_code,
                                d.break_time as max_dt,
                                d.available
                           from mana0809.TBL_CRC_ITCPORTAL_BREAK_TYP d,
                                (select d.employee_code,
                                        max(d.break_time) as max_dt
                                   from mana0809.TBL_CRC_ITCPORTAL_BREAK_TYP d
                                  group by d.employee_code) x
                          where d.break_time = x.max_dt) x
          on (x.employee_code = lo.employee_code)
        left outer join (select t.max_dt1, t.emp_code
                           from mana0809.tbl_crc_followup_dtl d
                           join (select t2.emp_code,
                                       max(t2.inserted_on) as max_dt1
                                  from mana0809.tbl_crc_followup_dtl t2
                                 group by t2.emp_code) t
                             on d.emp_code = t.emp_code
                            and d.inserted_on = t.max_dt1) y
          on (lo.employee_code = y.emp_code),
       (select t.emp_code,
                     e.emp_name,
                     listagg(t.col_language, ' , ') within group(order by t.col_language) col_language
                from (select distinct t.col_language, t.emp_code
                        from mana0809.tbl_crc_bucket_emp_dtl t) t,
                     mana0809.tbl_crc_emp_dtls e
               where t.emp_code = e.emp_code
               group by t.emp_code, e.emp_name) l
       where l.emp_code = lo.employee_code;
  
  elsif p_flag = 'Break_Modal' then
    v_splitter := splitstr(p_parval1, '~');
    if v_splitter(1) = 'FEEDBACK' then
      insert into TBL_CRC_ITCPORTAL_BREAK_TYP
        (employee_code, BREAK_TYPE, BREAK_TIME, Feedback, AVAILABLE)
      values
        (p_parval2, v_splitter(1), sysdate, v_splitter(2), '');
      commit;
    else
      insert into TBL_CRC_ITCPORTAL_BREAK_TYP
        (employee_code, BREAK_TYPE, BREAK_TIME, Feedback, AVAILABLE)
      values
        (p_parval2, v_splitter(1), sysdate, '', '');
      commit;
    end if;
    open QRY_RESULT for
      select '666' from dual;
  
  elsif p_flag = 'Avail_Modal' then
  
    select max(t.break_time)
      into mx_date1
      from TBL_CRC_ITCPORTAL_BREAK_TYP t
     where t.employee_code = p_parval2
       and t.available is null;
    update TBL_CRC_ITCPORTAL_BREAK_TYP t
       set t.available = sysdate
     where t.break_time = mx_date1;
    commit;
    open QRY_RESULT for
      select '666' from dual;
  
  elsif p_flag = 'break_sts' then
  
    select t.available
      into avl_st
      from TBL_CRC_ITCPORTAL_BREAK_TYP t
     where t.break_time =
           (select max(t.break_time)
              from TBL_CRC_ITCPORTAL_BREAK_TYP t
             where t.employee_code = p_parval2);
    if avl_st is null then
      open QRY_RESULT for
        select '111' from dual;
    
    else
      open QRY_RESULT for
        select '555' from dual;
    end if;
  
    ----------------------CRF_102144----- 358536 -----------------------------------------------------
    --------------------change--2
  elsif p_flag = 'get_sms_content' then
    open QRY_RESULT for
      select m.cust_name, t.branch_name, t.phone2
        from BRANCH_MASTER t, tbl_crc_mst m
       where t.branch_id = m.branch_id
         and m.lead_id = p_parval1;
  
  elsif p_flag = 'sms_status_check' then
  
    select count(t.mobile_no)
      into mob_count
      from TBL_CRC_SMS_DTL t
     where t.mobile_no = p_pageval
       and t.lead_id = p_parval1;
    if mob_count = 0 then
      select count(m.lead_id)
        into lead_count1
        from tbl_crc_mst m
       where m.mobile_number = p_pageval
         and m.lead_id = p_parval1
         and m.followup_status = 0
         and m.lead_source_cat in (8);
      if lead_count1 = 1 then
        open QRY_RESULT for
          select '111' from dual;
      end if;
    
    end if;
  elsif p_flag = 'insert_sms_log' then
    insert into TBL_CRC_SMS_DTL values (p_pageval, sysdate, p_parval1);
    commit;
  
  elsif p_flag = 'searchempcode' then
    select count(t.emp_code)
      INTO empcount
      from TBL_CRC_EMP_DTLS t
     where t.emp_code = p_pageval;
    if empcount > 0 then
      open QRY_RESULT for
        select '111' from dual;
    else
      open QRY_RESULT for
        select '222' from dual;
    end if;
    --------------------------------------------------------------------------------------------
  elsif p_flag = 'addempcode' then
    v_splitter := splitstr(p_pageval, '~');
    insert into TBL_CRC_EMP_DTLS t
    values
      (v_splitter(1), v_splitter(2), 1, 1, v_splitter(3), v_splitter(3));
    commit;
    open QRY_RESULT for
      select '111' from dual;
  
    -----------------change---2
  
    -----------------------------------366371
  elsif p_flag = 'getproductid' then
    open QRY_RESULT for
      select t.product_status
        from TBL_CRC_PRODUCTS t
       where t.products_id = p_pageval;
  
  elsif p_flag = 'getmailaddress' then
    open QRY_RESULT for
      select m.dept_mail
        from tbl_crc_department_mail m
       where m.product_id = p_pageval;
  
  elsif p_flag = 'getmailcontents' then
  
    select t.mobile_number
      into l_mob
      from tbl_crc_mst t
     where t.lead_id = p_pageval;
    select count(c.cust_id)
      into v_cust_type
      from customer c
     where c.phone1 = to_char(l_mob)
        or c.phone2 = to_char(l_mob);
  
    open QRY_RESULT for
      select distinct (t.inserted_on),
                      case
                        when v_cust_type = 1 then
                         'Existing Customer'
                        else
                         'New Customer'
                      end,
                      'lead',
                      t.cust_name,
                      t.mobile_number,
                      case
                        when t.mobile_number = t.initial_mobile_no then
                         'NIL'
                        when t.initial_mobile_no IS NULL then
                         'NIL'
                        else
                         t.initial_mobile_no
                      end,
                      
                      t.callcenter_comment,
                      t.branch_id,
                      b.branch_name,
                      b.area_name,
                      b.reg_name,
                      b.state_name,
                      g.fzm,
                      t.product_name,
                      
                      case
                        when v_cust_type = 1 then
                         t.cust_name
                        else
                         'NIL'
                      end
      
        from tbl_crc_mst             t,
             tbl_leadsource_category s,
             TBL_CRC_PRODUCTS        p,
             branch_detail_new       b,
             tbl_crc_bucksize        bb,
             --state_master            bm,
             tbl_fzm_master g
      
       where t.lead_source_cat = s.leadsource_id
         and t.product_id = p.products_id
            --and b.branch_id = t.branch_id
         and b.branch_id = t.followup_branch_id
            --and b.state_id = bm.state_id
         and bb.bucket_id = t.bucket_id
         and g.region_id = b.reg_id
            
         and t.lead_id = p_pageval;
  
    -----------------------------------end------------366371
    -----358141----
  elsif p_flag = 'Confirm_Check' then
    --confirm_check for API update
    --select max(t.followup_id) into v_lead_followup_id from TBL_CRC_FOLLOWUP_DTL t where t.lead_id=p_parval1;
    open QRY_RESULT for
    --select count(t.lead_id) from TBL_CRC_FOLLOWUP_DTL t where t.lead_id=p_parval1 and t.followup_id=v_lead_followup_id and t.call_status is not null and t.call_duration is not null;
      select '1' from dual;
  
  elsif p_flag = 'test' then
    v_splitter := splitstr(p_parval1, '^');
    v_splitter(1) := 0;
  
    open QRY_RESULT for
      select v_splitter(1) from dual;
  
    ------------------------------------------------------------------------------313301
  elsif p_flag = 'REMARKHIS' then
    open QRY_RESULT for
      select nvl(c.required_amnt, '') || '§' ||
             listagg(to_char(t.call_center_comment) || 'µ' ||
                     to_char(t.inserted_on),
                     '¶') within group(order by t.lead_id)
        from mana0809.tbl_crc_mst c
        left outer join mana0809.TBL_CRC_FOLLOWUP_DTL t
          on (t.lead_id = c.lead_id and t.call_center_comment is not null)
       where c.lead_id = p_pageval
       group by c.required_amnt;
  
  elsif p_flag = 'saveuniqid' then
  
    v_splitter := splitstr(p_parval1, '^');
  
    v_splitter2 := splitstr(p_parval2, '^');
  
    select t.lead_id
      into v_lead_id
      from tbl_crc_followup_dtl t
     where t.mobile = v_splitter(2)
       and trunc(t.inserted_on) = trunc(sysdate)
       and t.followup_id =
           (select max(f.followup_id)
              from tbl_crc_followup_dtl f
             where f.mobile = v_splitter(2));
  
    select count(t.lead_id)
      into v_Count
      from TBL_CRC_MST t
     where t.lead_id = v_lead_id
       and t.mobile_number = v_splitter(2);
  
    if v_Count > 0 then
    
      select max(t.followup_id)
        into v_lead_followup_id
        from tbl_crc_followup_dtl t
       where t.lead_id = v_lead_id
         and trunc(t.inserted_on) = trunc(sysdate);
    
      if v_lead_followup_id is not null then
      
        update TBL_CRC_FOLLOWUP_DTL f
           set f.call_uniqid = v_splitter2(1), f.call_log = v_splitter2(2)
         where f.lead_id = v_lead_id
           and f.followup_id = v_lead_followup_id
           and trunc(f.inserted_on) = trunc(sysdate)
           and f.call_uniqid is null;
      
      end if;
    
    end if;
  
    open QRY_RESULT for
      select '111' from dual;
  
    ---------------------------------------------------------------------------------313301
    ----------------------------366371--------------if cause(dispostion)=17 thenthis works
  
  elsif p_flag = 'call_satus_insert' then
    update TBL_CRC_FOLLOWUP_DTL
       set call_status = 2
     where lead_id = p_pageval
       and followup_id =
           (select max(t.followup_id)
              from tbl_crc_followup_dtl t
             where t.lead_id = p_pageval
               and trunc(t.inserted_on) = trunc(sysdate));
    commit;
  
    -----------------------------366371--------------if cause(dispostion)=17 thenthis works
    --------------------------------115004----------start--------------------
     elsif p_flag='Get_QAnum_dtl' then
       
       open QRY_RESULT for 
   --  select  t.call_id || '¥' || tt.cust_name, t.mob_no
   select  t.call_id || '-' || tt.cust_name, t.mob_no
       from tbl_qa_module t, tbl_crc_mst tt
      where to_char(t.mob_no) = tt.mobile_number
        and not exists (select *
               from tbl_my_qa u
              where u.qa_mobile = to_char(t.mob_no)
                and u.status = 1)
        and t.emp_code = p_pageval;
        
        
          elsif p_flag='pop_fatal' then
          if p_parval1=7 then
          cat:='G';
        end if;
        open QRY_RESULT for
       select T.QUST_NO,t.qa_qstns,t.qa_id from TBL_QA_MODULE_QST t
       where t.status_id = 2
       and t.flag=3
       and t.category_id=cat
       order by t.qa_id; 
          
        elsif p_flag='popup_mark' then
       
       if p_parval1=1 then
         
       cat:='A';
       elsif
          p_parval1=2 then
          cat:='B';
         elsif
           p_parval1=3 then
          cat:='C';
         elsif
           p_parval1=4 then
          cat:='D';
         elsif
           p_parval1=5 then
          cat:='E';
         elsif
           p_parval1=6 then
          cat:='F';
         
          end if;
         open QRY_RESULT for
         
       select T.QUST_NO,t.qa_qstns,t.score,t.qa_id from TBL_QA_MODULE_QST t
       where t.status_id in (1,2)
       and t.flag<>2
       and t.category_id=cat
       order by t.qa_id;
        
 
  
      elsif p_flag='QA_update' then
     v_splitter := splitstr(p_pageval, '^');  
       
    insert into tbl_my_qa
      (emp_code, qa_mobile, remarks, eva_date,status,call_id)
    values
      (v_splitter(1), v_splitter(3), v_splitter(2), sysdate,1,v_splitter(4));
   open QRY_RESULT for
      select '111' from dual;
      
       elsif p_flag='qa_claim' then
       v_splitter := splitstr(p_pageval, '^'); 
       
    insert into tbl_my_qa
      
      (emp_code,qa_mobile, remarks, eva_date,status,call_id)
    values
      (v_splitter(1), v_splitter(3), v_splitter(2), sysdate,1,v_splitter(4));
   open QRY_RESULT for
      select '111' from dual;
      
    elsif p_flag='notify' then
      
    select count(*) into notify
      from tbl_qa_module t
     where t.verified_by is not null
       and t.emp_code = p_pageval
       and not exists (select *
              from tbl_my_qa h
             where to_char(t.mob_no) = h.qa_mobile
               and t.emp_code = h.emp_code);
            if (notify>0) then   
               open QRY_RESULT for
               select '111' from dual;
             
               end if;
               
        elsif p_flag = 'get_qa_rem' then
       
        open QRY_RESULT for   
   select m.remarks 
  from tbl_qa_qst_updation q, tbl_qa_module m
 where q.mob_nub = m.mob_no
 and q.call_id=m.call_id
   and q.mob_nub = p_pageval;
       
        
         
              
          elsif p_flag = 'qaremarkfill' then
    open QRY_RESULT for
select q.emp_code || '~' ||
       q.mob_nub || '~' ||
       q.verify_date || '~' ||
       q.verifid_by || '~' ||
       q.a || '~' ||
       q.b|| '~' ||
       q.c|| '~' ||
       q.d|| '~' ||
       q.e|| '~' ||
       q.f|| '~' ||
        case
             when  m.fatal_error = '0^0^0' then
              'No Fatal error'
             else
              'Fatal error Found'
           end || '~' ||
       case
             when  m.wow = 1 then
              '*'
             else
              '0'
           end || '~' ||
       q.total_mark || '~' ||
       q.qst_ans || '~' ||
       m.fatal_error || '$'
      from tbl_qa_qst_updation q,tbl_qa_module m where q.mob_nub=m.mob_no and q.mob_nub=p_pageval;
          --------------------------------115004----------end--------------------

  end if;
  commit;

exception
  when others then
  
    commit;
  
end proc_CRC_Main;
